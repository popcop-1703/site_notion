<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Практическая работа №4.3</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(249, 228, 188, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="b2af73a2-5915-4962-ab83-92c82c8396c8" class="page sans"><header><h1 class="page-title">Практическая работа №4.3</h1><p class="page-description"></p></header><div class="page-body"><hr id="9f07379e-2008-43ce-bd85-01224a2f46f5"/><h2 id="4f68a5c4-e725-4d04-85e2-0693c7dbe2f1" class="">Практическая работа &quot;Fail2Ban и Dos/DDoS attack&quot; на примере nginx.</h2><h3 id="1ffe9edc-2c14-4e2a-8710-0e4922604e43" class=""><strong>Цель работы:</strong></h3><ol type="1" id="e136fbf1-30d8-43fe-8394-4c248f4d0ede" class="numbered-list" start="1"><li>Научиться конфигурировать Fail2Ban для отражения атак Dos/DDoS на nginx.</li></ol><h3 id="4195d56e-529c-48f7-8ce5-a569b1ee73d8" class="">Задача:</h3><ul id="cbd4caf5-a636-45a1-83c0-1c15cfe65b81" class="bulleted-list"><li style="list-style-type:disc">Организовать простую-тестовую атаку DoS.</li></ul><ul id="eb32ddb5-0cdb-45a7-8736-7de8980d9c30" class="bulleted-list"><li style="list-style-type:disc">Защитить сервер от DoS/DDoS атак через встроенные возможности nginx.</li></ul><ul id="1948eced-d726-40dd-ab23-69c9ac11406b" class="bulleted-list"><li style="list-style-type:disc">Защитить сервер от DoS/DDoS атак с помощью fail2ban при помощи iptables в автоматическом режиме.</li></ul><ul id="fe92e6bb-ef77-4bf4-9ad6-7d2bff8a6827" class="bulleted-list"><li style="list-style-type:disc">Защитить сервер от DoS/DDoS атак с помощью fail2ban при помощи ipset в автоматическом режиме.</li></ul><p id="37ddc502-09be-4d66-899b-ca4ba65b71fa" class="">
</p><h3 id="e077efaf-4676-4d6a-9476-f66c9fe128f9" class="">1. Разворачивание сервера nginx на базе дистрибутивов Debian.</h3><p id="cdd50a85-2359-4240-88a0-d2302146e6f1" class=""><strong>Установите пакеты, необходимые для подключения apt-репозитория:</strong></p><p id="1b93c4e2-f899-46b7-8ea6-e8173d525cf7" class=""><code>sudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring</code></p><figure id="1036a4a0-e930-4d8b-8dcb-332e6fcdfa91" class="image"><a href="https://i.imgur.com/6UIi5ys.png"><img src="https://i.imgur.com/6UIi5ys.png"/></a></figure><p id="a2fdf6bd-328d-4059-9393-873d81c2a423" class=""><strong>Теперь нужно импортировать официальный ключ, используемый apt для проверки подлинности пакетов. Скачайте ключ:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e5773a83-c92d-429d-ad8c-fe6ac7f9772f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">curl &lt;https://nginx.org/keys/nginx_signing.key&gt; | gpg --dearmor
    | sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null
</code></pre><figure id="d2912bea-031e-42e1-a381-2687e5a29f95" class="image"><a href="https://i.imgur.com/ZRE9vvR.png"><img src="https://i.imgur.com/ZRE9vvR.png"/></a></figure><p id="370f340b-ab07-4a2f-bb1b-a919fb2d2e47" class=""><strong>Проверьте, верный ли ключ был загружен:</strong></p><p id="93327f01-6f67-4278-81c1-6818ba3bf600" class=""><code>gpg --dry-run --quiet --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg</code></p><figure id="b9229d00-ef15-43c5-872d-3fc654aa3dc2" class="image"><a href="https://i.imgur.com/DyM9L3i.png"><img src="https://i.imgur.com/DyM9L3i.png"/></a></figure><p id="cd4927b6-2e11-4724-a2df-402297055969" class="">Вывод команды должен содержать полный отпечаток ключа</p><p id="715c3b83-03b1-4404-80ae-f32c421c82be" class=""><strong>573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3e8fac0a-0359-40af-b25c-013b08cfa24e" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">pub   rsa2048 2011-08-19 [SC] [expires: 2024-06-14]
      573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62
uid                      nginx signing key &lt;signing-key@nginx.com&gt;
</code></pre><p id="8e1c917f-c580-4517-b978-202127edefb0" class=""><em><strong>Если отпечаток отличается от вышеуказанного, удалите файл ключа.</strong></em></p><p id="f68c50ba-cfb7-4a50-97ed-c2b87871afa2" class=""><strong>Для подключения apt-репозитория для стабильной версии nginx, выполните следующую команду:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b5f856c9-7418-4703-aaf4-24ab5ad191ed" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">echo &quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\
&lt;http://nginx.org/packages/debian&gt; `lsb_release -cs` nginx&quot; \\
    | sudo tee /etc/apt/sources.list.d/nginx.list
</code></pre><figure id="aea68c85-d998-4664-8b6b-5948458629bb" class="image"><a href="https://i.imgur.com/QapchaM.png"><img src="https://i.imgur.com/QapchaM.png"/></a></figure><p id="81b91486-ae65-46a5-93d9-a22d230df8c7" class=""><strong>Если предпочтительно использовать пакеты для основной версии nginx, выполните следующую команду вместо предыдущей:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="387f6b21-ba65-459b-83f6-90415e06541b" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">echo &quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\
&lt;http://nginx.org/packages/mainline/debian&gt; `lsb_release -cs` nginx&quot; \\
    | sudo tee /etc/apt/sources.list.d/nginx.list
</code></pre><figure id="1660d58d-a895-48d2-909e-422d82f48c57" class="image"><a href="https://i.imgur.com/k2wnbww.png"><img src="https://i.imgur.com/k2wnbww.png"/></a></figure><p id="96ba2862-eebd-4880-874e-5f5f9b5b3609" class=""><strong>Для использования пакетов из нашего репозитория вместо распространяемых в дистрибутиве, настройте закрепление:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2feafde9-5ffe-4cff-aeda-0f3ffd6507ff" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">echo -e &quot;Package: *\\nPin: origin nginx.org\\nPin: release o=nginx\\nPin-Priority: 900\\n&quot; \\
    | sudo tee /etc/apt/preferences.d/99nginx
</code></pre><figure id="74457a80-8ed7-40a5-a2dc-4ca2778caf29" class="image"><a href="https://i.imgur.com/2XulTDx.png"><img src="https://i.imgur.com/2XulTDx.png"/></a></figure><p id="d1b3ab05-e39a-4de0-9be8-2a996ff9b82a" class=""><strong>Чтобы установить nginx, выполните следующие команды:</strong></p><p id="1743c028-60c5-45dc-ad24-70546a9794fe" class=""><code>sudo apt update</code></p><figure id="f117e72d-345a-46be-bc9d-8d1788bfdc6c" class="image"><a href="https://i.imgur.com/GJbw2SN.png"><img src="https://i.imgur.com/GJbw2SN.png"/></a></figure><p id="b7144cd6-3d2b-4526-83da-5d6f952387c6" class=""><code>sudo apt install nginx</code></p><figure id="6aa0c2a5-aa4e-4840-b90a-0c1ae87b11e1" class="image"><a href="https://i.imgur.com/xIRqKE8.png"><img src="https://i.imgur.com/xIRqKE8.png"/></a></figure><p id="e65ac569-7bbf-4ce8-be22-314ac8280f55" class=""><em>Если всё сделали правильно, то появится стартовая страница.</em></p><p id="8ae3888d-4f6a-4612-a7db-a925b1a18258" class=""><strong>Стартовая страница nginx выглядит так:</strong></p><figure id="6dc9e094-328c-4959-8a85-1f9c7cf2663e" class="image"><a href="https://i.imgur.com/k27o5MA.png"><img src="https://i.imgur.com/k27o5MA.png"/></a></figure><p id="57311ba4-f29f-425d-be60-b920bf53c0b0" class=""><strong>если установлен nginx и apache2, то есть вероятность, что при запуске nginx будет появляться стартовая страничка apache2, в этом случае можно сделать следующее:</strong></p><p id="c29a9ee8-81bb-41e1-b4f3-dccd10f601bc" class=""><code>cd /var/www/html</code></p><p id="560165c3-df57-4fa6-9319-4bf23238235c" class="">создать директорию, куда затем переместить или скопировать файл index.html</p><p id="c15f2a32-cbef-4a19-b9d5-e7231a9c3f0f" class=""><code>cp index.html folder1/</code></p><p id="bc36a0e7-d684-49a6-9f33-3840e26e509b" class="">После этих манипуляций при запуске nginx будет появляться стартовая страничка nginx.</p><h3 id="b5fbf704-4a13-4f82-a5cd-3a606a9a330a" class="">2.Далее переходим к настройке nginx от DDoS атак на наш сервер.</h3><p id="3d748864-8296-43e3-b483-cfeabd84c56c" class=""><strong>Устанавливаем fail2ban и ipset:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b3b489f9-2112-4a7e-8c53-e80eee9cd67f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">apt install fail2ban

apt install ipset - дополнение, чтобы fail2ban мог эффективнее блокировать большое количество запросов
</code></pre><p id="8dd851c2-0433-4992-918e-ed133eb0a294" class="">далее переходим:</p><p id="ee2f658e-ea35-4da1-b166-495e564c6c3b" class="">nano /etc/nginx/sites-enable/default - тут находится стартовая страничка nginx</p><p id="755702f0-b407-4178-a2cb-8b2fe143d553" class=""><strong>выставляем следующие параметры:</strong></p><p id="5eac04df-47da-4300-b39d-ceced05ab8c1" class=""><code>limit_req zone=ltwo burst=5 nodelay;</code></p><figure id="50303f52-b3dd-4e7f-b98a-6f1a6ee04a29" class="image"><a href="https://i.imgur.com/nTwhb9T.png"><img src="https://i.imgur.com/nTwhb9T.png"/></a></figure><p id="ffdcea25-8c6c-497a-9282-b2bcb15ca030" class=""><strong>далее переходим в конфигурационный файл nginx.conf:</strong></p><p id="bf0bd8e3-cec2-4f32-b678-de2672dfb3b0" class=""><code>nano /etc/nginx/nginx.conf</code> - <strong>в данном файле нам надо внести следующие изменения:</strong></p><p id="61e7030e-d4f4-4457-9c99-ae1d19a14eb7" class=""><br/>limit_req_zone $binary_remote_addr zone=ltwo:10m rate=3r/s;<br/></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e8e3c75b-aed3-4eb6-a749-dea28363714a" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"></code></pre><figure id="be5da327-444f-41fa-8270-644a3061d458" class="image"><a href="https://i.imgur.com/EE9KqTc.png"><img src="https://i.imgur.com/EE9KqTc.png"/></a></figure><p id="c698a35e-4dcf-4052-9779-b7c44ac7f303" class="">после чего вбиваем ip-адрес сервера в браузере, переходим в режим разработчика и далее делаем многочисленные запросы: в Chrome это - ctrl+r</p><figure id="cc705652-cdbe-42bd-a57a-88d0b69b18a4" class="image"><a href="https://i.imgur.com/C9NijKb.png"><img src="https://i.imgur.com/C9NijKb.png"/></a></figure><p id="194538a8-9a98-42b0-9650-e4e9614aefc2" class="">после зажатия ctrl+r - выйдет ошибка 503</p><figure id="c720fe0a-4312-45f2-a790-e34590291037" class="image"><a href="https://i.imgur.com/Qb6eKkg.png"><img src="https://i.imgur.com/Qb6eKkg.png"/></a></figure><p id="830b4b43-b538-4c2d-8b2e-5c1575c67838" class=""><strong>данные ошибки будут отображаться в log файле:</strong></p><p id="2dc37cee-479d-40ad-af3f-5b0432fd1515" class=""><code>cat /var/log/nginx/error.log</code></p><figure id="72827988-9d18-4b59-ad8c-bf2895b056d9" class="image"><a href="https://i.imgur.com/Unbc5nm.png"><img src="https://i.imgur.com/Unbc5nm.png"/></a></figure><figure id="8b441e9d-b26d-4232-b2f8-ce22a71594ab" class="image"><a href="https://i.imgur.com/Q8w31i8.png"><img src="https://i.imgur.com/Q8w31i8.png"/></a></figure><p id="74ce3d6b-2111-426d-90b8-003800388296" class="">данные log файл даст нам нужную информация для настройки фильтрации fail2ban.</p><h3 id="20095471-837a-416d-baf7-5b93fd368907" class="">2. Настройке fail2ban от DDoS атак на наш сервер.</h3><p id="56f19022-bd44-4889-a644-d3fba3884079" class=""><strong>Давайте найдём параметр бан в jail.conf или во вновь созданном файле jail.local внесём следующие параметры:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="65751f34-0178-4c30-9f92-f448f8973fff" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">[nginx-limit-req]
port = http, https
enabled = true
filter = nginx-limit-req
action = iptables-multiport[name=ReqLimit, port=&quot;http,https&quot;, protocol=tcp]
logpath = /var/log/nginx/*error.log
findtime = 600
bantime = 3600
maxretry = 4
</code></pre><figure id="33a1ac9b-5725-4db8-92d1-c4c8f9ed72e8" class="image"><a href="https://i.imgur.com/Up7fK85.png"><img src="https://i.imgur.com/Up7fK85.png"/></a></figure><p id="9fbb298d-1239-4c63-9209-8c17db8a6431" class="">после чего нам необходимо изменить настройку, что iptables не отсылал reject а отсылал drop, так как для борьбы с ботами - это более эффективно.</p><p id="8b9978b6-f1e9-41b6-8520-16749a58dd64" class=""><strong>Далее переходим в файл:</strong></p><p id="b9a8b4da-c38d-4656-8bfc-8507822fb6a7" class=""><code>nano /etc/fail2ban/action.d/iptables-common.conf</code></p><figure id="3d5ef096-31d4-454f-b031-dac8747905fa" class="image"><a href="https://i.imgur.com/JvxU9uW.png"><img src="https://i.imgur.com/JvxU9uW.png"/></a></figure><p id="179a76bd-6ac8-46b4-9ee5-2afe65230b81" class=""><strong>но как мы уже знаем, настройки конфигурационных файлов поумолчанию могут быть перезаписаны при обновлении, поэтому создаём новый файл:</strong></p><p id="b8ca9051-dfb2-416d-87e0-b42ee41e4805" class=""><code>touch iptables-blocktype.local</code></p><p id="158db7b0-9973-4e4d-98ac-381b62fb5bde" class=""><strong>где нам нужно внести следующую настройку:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0398ee5e-d6f7-4e50-8854-a0ee70062c0c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">[Init]
blocktype = DROP
</code></pre><figure id="9be6dd0f-a37d-419f-9d11-b10f448ab7dc" class="image"><a href="https://i.imgur.com/tFb8JUY.png"><img src="https://i.imgur.com/tFb8JUY.png"/></a></figure><p id="db29911e-a80a-460a-97e1-d1476b0eca0b" class=""><strong>Затем делаем рестар fail2ban:</strong></p><p id="0a66fa63-9295-4579-a1c9-2e60adc23a20" class=""><code>service fail2ban restart</code></p><figure id="8ae9d370-29ce-49ce-952c-bd9e4b74821a" class="image"><a href="https://i.imgur.com/PdScDYA.png"><img src="https://i.imgur.com/PdScDYA.png"/></a></figure><p id="556d833b-0cfe-4be0-884b-b99e5d8539c1" class=""><strong>Теперь нам нужно посмотреть, что iptables отрабатывает и наберём:</strong><code>iptables -L -v</code></p><figure id="be1b2ac7-f0c0-4c65-8f0a-900fa2eda63e" class="image"><a href="https://i.imgur.com/azTTzgn.png"><img src="https://i.imgur.com/azTTzgn.png"/></a></figure><p id="8b93892d-1da3-4a20-9f79-be1f10d10495" class=""><strong>Убедимся. что настройки в fail2ban применились и введём:</strong></p><p id="40083b5f-a542-46a2-8299-f728e55a76af" class=""><code>fail2ban-client status</code></p><figure id="86b9c55d-820b-44ab-b536-b1714408545d" class="image"><a href="https://i.imgur.com/HUEvtAz.png"><img src="https://i.imgur.com/HUEvtAz.png"/></a></figure><p id="6b002abc-6935-4fa1-a1e6-c3c977bd83f6" class=""><em>видим, что фильтры работают по nginx-limit-req, sshd</em></p><p id="b7a4d04b-7c51-4ee1-b283-c13bb3143285" class=""><strong>также проверим, что сейчас нет заблокированных ip-адресов:</strong></p><p id="0ed8e746-5b56-4b56-b14d-5148ea22e1a7" class=""><code>fail2ban-client status nginx-limit-req</code></p><figure id="8b0b2bdd-d61a-4574-bed3-59a12b967b80" class="image"><a href="https://i.imgur.com/ElbHjEm.png"><img src="https://i.imgur.com/ElbHjEm.png"/></a></figure><p id="a44eadd6-b592-4867-9ba3-1496e33deedb" class=""><em>теперь переходим на нашу страничку и вводим ip-адрес сервера в браузере, переходим в режим разработчика и далее делаем многочисленные запросы: в Chrome это - ctrl+r</em></p><p id="2fea0662-5bb9-49b7-b856-34ea1de82c54" class=""><strong>и видим вот такое сообщение после многочисленных запросов:</strong></p><figure id="21f17ad7-eb6d-4eb2-baf3-6617e7785aef" class="image"><a href="https://i.imgur.com/JFDVv15.png"><img src="https://i.imgur.com/JFDVv15.png"/></a></figure><p id="f69542b0-42e7-4e5f-aace-73ae9ae5968c" class=""><strong>переходим на сервер и смотрим что у нас показывает iptables и fail2ban:</strong></p><p id="2d6acf56-fc77-44be-826e-46581cac6934" class=""><code>iptables -L -v</code></p><figure id="23ab4b9e-95d9-4523-bc6d-723d2b5b8d58" class="image"><a href="https://i.imgur.com/qlI0hDL.png"><img src="https://i.imgur.com/qlI0hDL.png"/></a></figure><p id="ea36de64-9643-4856-ab8d-4d26f805b4ed" class=""><em>Видим, что добавилось правило</em></p><p id="dfcca8a3-957a-4958-ad85-be192c922da2" class=""><strong>Далее переходим и смотрим, что показывает fail2ban:</strong></p><figure id="a42e3b91-fb1d-40ba-981c-a8412b1e74a6" class="image"><a href="https://i.imgur.com/1ztsNvR.png"><img src="https://i.imgur.com/1ztsNvR.png"/></a></figure><p id="11d1c616-e944-4326-a296-17b384f86f47" class=""><em>Тут как раз показывает ip-адрес компьютера, который делал многочисленные запросы.</em></p><p id="478a4144-4457-400e-993f-7a6473f97e83" class=""><strong>Разблокировать нужный ip-адрес возможно с помощью слудующей команды:</strong></p><p id="2346833c-ca8f-4f27-b327-f2e279c7abec" class=""><code>fail2ban-client unban [ip-адресс]</code></p><figure id="04dc9df2-869d-43c6-b3b3-bf9e6fe57770" class="image"><a href="https://i.imgur.com/8A8Umev.png"><img src="https://i.imgur.com/8A8Umev.png"/></a></figure><p id="20b1651a-1be6-4d04-9261-6bb1722d3448" class="">
</p><p id="5713268f-8c03-4bb6-a10a-5b0c8e7a4481" class="">
</p><h3 id="0bc2cf59-2e87-40b1-9bef-0a833a999a52" class="">3. Т.е. мы в этой практической работе выполнили несколько условий:</h3><ol type="1" id="e29ae30a-7352-452b-916b-9094ea0aac8a" class="numbered-list" start="1"><li>Организовали простую-тестовую атаку DOS.</li></ol><ol type="1" id="028fdd7b-7750-40f7-8fb6-fad9963f8724" class="numbered-list" start="2"><li>Защитили сервер от DoS/DDoS атак через встроенные возможности nginx.</li></ol><ol type="1" id="52345f36-6057-43c7-98be-ca45f516522a" class="numbered-list" start="3"><li>Защитили сервер от DoS/DDoS атак с помощью fail2ban при помощи iptables в автоматическом режиме.</li></ol><p id="81de8c04-d7cb-4e21-afb2-b9357d88355e" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>