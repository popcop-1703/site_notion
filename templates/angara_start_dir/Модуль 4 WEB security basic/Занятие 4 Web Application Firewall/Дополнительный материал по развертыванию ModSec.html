<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Дополнительный материал по развертыванию ModSecurity 3</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(249, 228, 188, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="aaa55944-0ad5-4287-bf74-be8399998392" class="page sans"><header><h1 class="page-title">Дополнительный материал по развертыванию <strong>ModSecurity 3</strong></h1><p class="page-description"></p></header><div class="page-body"><h3 id="debe1328-eb71-4540-b8da-9479b1b471cc" class=""><strong>How to Install ModSecurity 3 &amp; <br/>OWASP Core Rule Set with Nginx on Ubuntu 20.04<br/></strong></h3><p id="f65928fe-1dec-445b-82ca-161697f4dfd4" class=""><strong><a href="https://github.com/SpiderLabs/ModSecurity">ModSecurity</a></strong><strong>, often</strong> referred to as <strong>Modsec,</strong> is a free, open-source web application firewall <strong>(WAF)</strong>. ModSecurity was created as a module for the Apache HTTP Server. However, since its early days, the WAF has grown and now covers an array of HyperText Transfer Protocol request and response filtering capabilities for various platforms such as Microsoft IIS, Nginx, and of course, Apache.</p><p id="ea5f3042-1b53-4e25-90ea-2e435f351816" class="">How the WAF works, the ModSecurity engine is deployed in front of the web application, allowing the engine to scan the incoming and outgoing HTTP connections. ModSecurity is most commonly used in conjunction with the <strong><a href="https://github.com/coreruleset/coreruleset">OWASP Core Rule Set (CRS)</a></strong>, an open-source set of rules written in ModSecurity’s SecRules language and is highly regarded among the security industry.</p><p id="c9188fbd-5c37-472d-92aa-c214f0fb5174" class="">OWASP Rule Set with ModSecurity can almost instantly help protect your server against:</p><ul id="3a488f7d-4dc6-44be-b0f4-5270ef7dbbfb" class="bulleted-list"><li style="list-style-type:disc">Bad user agents</li></ul><ul id="0c36267e-a0ac-40f7-8781-80943cab39d0" class="bulleted-list"><li style="list-style-type:disc">DDOS</li></ul><ul id="c97bbf74-b716-471a-a746-1bf17cfda8cc" class="bulleted-list"><li style="list-style-type:disc">Cross website scripting</li></ul><ul id="ae84cb9f-8333-4b28-9cee-74ed829ce052" class="bulleted-list"><li style="list-style-type:disc">SQL injection</li></ul><ul id="aea0f36d-a5e3-468e-a92b-6e7f25577e6f" class="bulleted-list"><li style="list-style-type:disc">Session hijacking</li></ul><ul id="57f739f5-429b-4d12-9e76-9c1d47268990" class="bulleted-list"><li style="list-style-type:disc">Other Threats</li></ul><h2 id="74c629cd-dccb-447f-a742-94f6228e7d0e" class=""><strong>Prerequisites</strong></h2><ul id="a5c5521c-2d25-47a2-9473-2a7104bdd01f" class="bulleted-list"><li style="list-style-type:disc"><strong>Recommended OS:</strong> <a href="https://releases.ubuntu.com/20.04/">Ubuntu 20.04</a> or higher</li></ul><ul id="91ca0667-91e2-45c2-a730-90221643fcde" class="bulleted-list"><li style="list-style-type:disc"><strong>User account: </strong>A user account with <strong>sudo</strong> or<strong> root access.</strong></li></ul><h3 id="bfc55eea-2478-4564-97a9-fdf246f89bad" class="">Update Operating System</h3><p id="3b9119e7-f552-4b4d-bc87-b9f174b15abf" class="">Update your <strong>Ubuntu</strong> operating system to make sure all existing packages are up to date:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6ebea08d-4ec6-493d-9107-5dfb0d0af1f4" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt update &amp;&amp; sudo apt upgrade -y</code></pre><p id="d44d71f8-792e-4adc-92b5-3f1edb4eab18" class="">The tutorial will be using the<strong> sudo command</strong> and <strong>assuming you have sudo status</strong>.</p><p id="67947a78-22ea-4937-8ccb-8341f9db1f36" class="">To verify sudo status on your account:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9720eeb1-0424-49ad-ab9e-0b25a3c1ef67" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo whoami</code></pre><p id="d3dddd4b-a175-4236-952f-cc9c9ebea55c" class=""><em>Example output showing sudo status:</em></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="58ccfc31-dea6-49dd-8eb3-f564dc22fc31" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">[joshua@ubuntu ~]$ sudo whoami
root</code></pre><p id="78e9c950-e6b8-4305-844b-1ae57461243c" class="">To set up an existing or new sudo account, visit our tutorial on <strong><a href="https://www.linuxcapable.com/how-to-add-a-user-to-sudoers-on-ubuntu/">How to Add a User to Sudoers on Ubuntu</a></strong><a href="https://www.linuxcapable.com/how-to-add-a-user-to-sudoers-on-ubuntu/">.</a></p><p id="b3daff0c-35be-4491-8e3e-19c3ddc9d268" class="">To use the <strong>root account</strong>, use the following command with the root password to log in.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b13c8a5d-4c95-4396-a394-fd728e3ea71d" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">su</code></pre><h2 id="dee7e134-0a3c-4427-a18f-b35c90ba3b90" class=""><strong>Install Latest Nginx on Ubuntu 20.04</strong></h2><p id="3aac6834-995e-44d4-8c4c-9c463942c7d1" class="">First, it is advised to remove any existing installations of Nginx and install the latest version using the custom <strong>PPA</strong> maintained by <strong>Ondřej Surý</strong>, which also comes with extra dynamic modules such as the Brotli module.</p><h3 id="075c52f9-96f2-424b-9b79-2376d646fa4e" class="">Remove Existing Nginx Installation</h3><p id="68162c9d-1feb-4eec-aa02-a10ee98ac662" class="">Stop the current Nginx service:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4d96b902-7a4e-4ef6-b82d-149922ab7a2b" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo systemctl stop nginx</code></pre><p id="f4216e17-9cf3-4034-a147-9e6ff2d544a5" class="">Now remove the existing Nginx installation as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4f0859d2-15e7-4032-b58f-ebd78e16ad6e" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt-get purge nginx -y &amp;&amp; sudo apt autoremove nginx -y</code></pre><h3 id="294404c8-3563-4744-9462-48d2492c80f6" class="">Add Latest Nginx PPA</h3><p id="264d5ce9-2427-4d99-945b-05fd2f9e5324" class="">Now that you have removed your old Nginx service, installing one of the two PPA’s listed below is recommended.</p><p id="7a985663-8aad-4d87-99c4-34d5545f9c32" class="">The tutorial always recommends installing the mainline as per Nginx’s recommendation.</p><p id="9949379b-ba62-4fb4-a080-9e8a48e9df67" class="">Install one of the following PPA’s with the following command:</p><p id="98d2aedb-b641-47d5-93f7-2c7f9ca67045" class=""><em><strong>Install latest Nginx (STABLE):</strong></em></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c043c8f4-4d6b-463f-81db-a274dbf1241a" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo add-apt-repository ppa:ondrej/nginx-stable -y &amp;&amp; sudo apt update</code></pre><p id="d453e796-3158-467c-88e7-ef5a0e6dd5f9" class=""><em><strong>Install latest Nginx (MAINLINE):</strong></em></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a404c8c7-54f2-45d7-a7a8-81896f5b99aa" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo add-apt-repository ppa:ondrej/nginx-mainline -y &amp;&amp; sudo apt update</code></pre><p id="5b5e8397-4300-4e92-b9d3-c0e2101376e8" class="">Now that you have installed the <strong>PPA</strong> and updated the repository list, install Nginx with the following:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="de6d2c6f-aca6-4343-aa22-9d030717701b" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt install nginx-core nginx-common nginx nginx-full</code></pre><p id="2afba38b-f6ee-4ff8-82dc-793ca00877e4" class="">Note that you may be prompted to keep or replace your existing <em><strong>/etc/nginx/nginx.conf </strong></em>configuration file during the installation. It is recommended to keep your current configuration file by pressing <strong>(n)</strong>.</p><h3 id="45682d14-69a8-467f-a4eb-4b3bfb351f89" class="">Add Nginx Source Code to Repository</h3><p id="7fadd164-7f19-44c3-b974-5657ad5013d1" class="">By default, the source code is not installed when installing the PPA. You will need to manually enable this to download the Nginx source code to compile Modsecurity later in the tutorial.</p><p id="ab7c5a7d-99a4-47c9-b123-a91e2f8a09ef" class="">First, open up the configuration file in <em><strong>/etc/apt/sources.list.d</strong></em> with nano as below:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="33b320ab-1f28-4b3a-a544-6ab12a7703af" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/apt/sources.list.d/ondrej-ubuntu-nginx-mainline-*.list</code></pre><p id="a3dd375d-0da8-4255-ae00-1134e01e83ee" class="">Now location the line that begins with <strong># deb-src</strong> and <strong>uncomment</strong> <strong>(#)</strong> the line.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6da14c4c-d93e-4c7d-9deb-059f0c2e586a" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"># deb-src http://ppa.launchpad.net/ondrej/nginx-mainline/ubuntu/ focal main</code></pre><p id="876ed3e9-3c3a-4695-bf07-003890022fb0" class=""><em>Example of what it should look like:</em></p><figure id="10204db2-c27b-4ce2-a24a-8531b1771ae7" class="image"><a href="https://www.linuxcapable.com/wp-content/uploads/2021/08/dbr-source-uncomment-nginx-modsecurity-install.png"><img src="https://www.linuxcapable.com/wp-content/uploads/2021/08/dbr-source-uncomment-nginx-modsecurity-install.png"/></a></figure><p id="18d445c7-a126-433e-a1f4-2bec8f1ef024" class="">Now save the file <strong>(CTRL+O)</strong> and exit <strong>(CTRL+X)</strong>. Now update the repository list using the following command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="438b7eb9-af89-4219-8acf-352a5aaaca8f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt update</code></pre><h2 id="b183c7e2-3b71-4f80-82e0-2ac2ba623a4c" class=""><strong>Download Nginx Source</strong></h2><p id="9447041b-0094-4751-89c6-2e0fbb562b85" class="">You will need to download the Nginx source code to compile the ModSecurity <strong>dynamic module</strong>. To do this, you will need to download and store the source package in the directory location <em><strong>/etc/local/src/nginx</strong></em>.</p><h3 id="35c2222e-fea9-46d2-a206-6c9bc932ce4f" class="">Create and Configure Directories</h3><p id="5c88b7b7-30e1-4d8a-a9de-e8fb3dbc89e9" class="">Create the location as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6fd369c3-6b62-4f52-a01c-0717332f2c2a" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo mkdir /usr/local/src/nginx &amp;&amp; cd /usr/local/src/nginx</code></pre><p id="4f829c84-ee36-4c63-9ff7-7752555bd59d" class="">Optional – Assign permission to the directory if needed as below:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="096b766a-3532-424b-a880-b98fe9c577dc" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo chown username:username /usr/local/src/ -R</code></pre><h3 id="1f667f70-0c4c-42b8-8361-34cd8b3312c1" class="">Install Dependencies and Execute Download</h3><p id="6c499933-17cb-4656-a561-889c78ccb9df" class="">Next, download the source package with the following:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a5d1f1f1-627b-4efe-9953-5295acdb9515" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt install dpkg-dev -y &amp;&amp; sudo apt source nginx</code></pre><p id="0f3f1f9b-06b4-4fda-a17b-4f361426602d" class="">Note, you will see the following error message as below:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="04fcbf4e-a8be-40f5-8ba8-0c28e4ddb111" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">dpkg-source: info: extracting nginx in nginx-1.21.1
dpkg-source: info: unpacking nginx_1.21.1.orig.tar.gz
dpkg-source: info: unpacking nginx_1.21.1-1+ubuntu20.04.1+deb.sury.org+1.debian.tar.xz
dpkg-source: info: using patch list from debian/patches/series
dpkg-source: info: applying 0001-Make-sure-signature-stays-the-same-in-all-nginx-buil.patch
dpkg-source: info: applying 0002-define_gnu_source-on-other-glibc-based-platforms.patch
W: Download is performed unsandboxed as root as file &#x27;nginx_1.21.1.orig.tar.gz&#x27; couldn&#x27;t be accessed by user &#x27;_apt&#x27;. - pkgAcquire::Run (13: Permission denied)</code></pre><p id="fa14fd31-7e45-46dc-a9b3-7519c1d8b01e" class="">This can be safely ignored.</p><h3 id="25ae27fa-5cac-4588-9ed9-57b44fe195c6" class="">Verify Source Version</h3><p id="4ddf5338-4f4d-4c23-9d9c-13bf1e5e97df" class="">Next, list the directories files with the <strong>ls</strong> command as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5e0b5d28-213e-4cbf-a892-3fae153c37bc" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">ls</code></pre><p id="5208c53f-8d16-4182-a36c-e2b97a092a00" class="">You should see the following output in your <strong>/usr/src/local/nginx</strong> directory:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="769b8ef7-e4c2-4bec-9f0f-0b09d2ac5366" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">jjames@ubuntu:/usr/local/src/nginx$ ls
nginx-1.21.1
nginx_1.21.1-1+ubuntu20.04.1+deb.sury.org+1.debian.tar.xz
nginx_1.21.1-1+ubuntu20.04.1+deb.sury.org+1.dsc
nginx_1.21.1.orig.tar.gz
nginx_1.21.1.orig.tar.gz.asc</code></pre><p id="535cb4a1-d85a-4822-80c0-4812b981efe1" class="">Next, confirm that the source package is the same as your Nginx version installed on your Ubuntu operating system. To do this, use the following <strong>nginx -v</strong> command as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5869a1ee-bc22-4c18-aa54-605a3a13add5" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">nginx -v</code></pre><p id="980f31a2-ede6-426b-9daf-40a444e42d9c" class="">You should get the same output version as the source as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="65fed2d5-429d-4a2f-8d43-462d5e3752e8" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">jjames@ubuntu:/usr/local/src/nginx$ nginx -v
nginx version: nginx/1.21.1</code></pre><h2 id="d21fa98d-0238-4716-a342-218276534b37" class=""><strong>Install libmodsecurity3 for ModSecurity</strong></h2><p id="0f0ce49e-9f89-46a0-97c6-fd7baafbe5dd" class="">The package <strong>libmodsecurity3</strong> is the actual part of the WAF that does the <strong>HTTP filtering</strong> for your web applications. On Ubuntu 20.04, you can install this from the default Ubuntu 20.04 repository. However, this is not recommended as with most LTS versions, and it often lags. Instead, you will compile from the far more up-to-date source as follows.</p><h3 id="59bb8c8d-d298-4fba-9e08-69e38ce4b292" class="">Clone ModSecurity Repsoitory from Github</h3><p id="2a99f50a-c5e7-4dc3-9d36-17c6f1d55258" class="">The first step is the clone from Github, and if you do not have git installed, you will need to execute the following command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2d952c8e-b608-4d2d-b42d-4c6dcc87d731" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt install git -y</code></pre><p id="e81c7a52-825c-43ae-8bbe-f3d74df60bda" class="">Note, this installs Ubuntu 20.04 default repository version. If you would like the latest up-to-date version using a PPA from the GIT repository team, please visit our guide on installing and updating the latest <strong><a href="https://www.linuxcapable.com/how-to-install-and-update-latest-git-on-ubuntu-20-04/">Git on Ubuntu 20.04</a></strong>.</p><p id="e944f8e6-1998-4a5c-9ab6-8f2b1f34ff80" class="">Next, clone the libmodsecurity3 GIT repository as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8a68773d-8165-424f-8a9b-bf72c70160f1" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">git clone --depth 1 -b v3/master --single-branch https://github.com/SpiderLabs/ModSecurity /usr/local/src/ModSecurity/</code></pre><p id="f2749646-5e8e-4acf-bfec-9ab331dd0668" class="">Once cloned, you will need to <strong>CD</strong> to the directory:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2a87361e-c6d6-477e-bf8c-c9deaf1e561c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">cd /usr/local/src/ModSecurity/</code></pre><h3 id="510e675f-5550-4c0b-b426-7d01113b151d" class="">Install libmodsecurity3 Dependencies</h3><p id="a03aedb7-fb56-4850-bf79-0bd1935a7624" class="">To compile, you will need to install the following dependencies as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fa539ff8-2fcc-4e29-85c8-9a59e038117b" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt install gcc make build-essential autoconf automake libtool libcurl4-openssl-dev liblua5.3-dev libfuzzy-dev ssdeep gettext pkg-config libpcre3 libpcre3-dev libxml2 libxml2-dev libcurl4 libgeoip-dev libyajl-dev doxygen -y</code></pre><p id="a817c513-d0e3-4ea4-a627-28f0826d535e" class="">Now to finish off, install the following GIT submodules as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fa9b9b82-0fef-475e-ad9a-f51a53953e12" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">git submodule init</code></pre><p id="f438a891-7380-44dc-ba1f-ae6777e6f29b" class="">Then update the submodules:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="026d8c4c-8368-48bf-85df-edc5ed62b704" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">git submodule update</code></pre><h3 id="db05ff16-24f9-4ecd-a925-df2ae178f114" class="">Building the ModSecurity Environment</h3><p id="dfea37c8-873e-45c7-8820-3f64b0e0254f" class="">The next step is now actually to build the environment first. Use the following command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3f10fb88-bf35-4eb9-af9d-83f502ffe60e" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">./build.sh</code></pre><p id="2c744c94-b3c9-4d7a-9917-9682acd89862" class="">Next, run the configure command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4a3f176f-075e-4439-ba15-069e34f656dd" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">./configure</code></pre><p id="89ee52e5-83c3-4d4a-95f9-f7f25f33ca64" class="">Note, you will possibly see the following error</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fa99be9b-817b-443d-9278-926225c527ed" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">fatal: No names found, cannot describe anything.</code></pre><p id="28435ffb-5331-4663-9e45-3bc9fdae3f1a" class="">You can safely ignore this and move on to the next step.</p><h3 id="c3152dfb-253f-4494-a5f1-09f50e0881b0" class="">Compiling the ModSecurity Source Code</h3><p id="c6d0323c-5528-481e-a4bd-2bceb94166d2" class="">Now that you have built and configured the environment for libmodsecurity3, it is time to compile it with the command <strong>make</strong>.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e63ee7c7-2e88-4855-aa4e-d10c338d45ba" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">make</code></pre><p id="8366b2ef-6c27-4350-8f94-e2ef93e81318" class="">A handy trick is to specify the <strong>-j &lt;number of cpu&gt; </strong>as this can significantly increase compiling speed if you have a powerful server. For example, the LinuxCapable server has 6 CPUs, and I can use all 6 or at least use 4 to 5 to increase speed.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f4189d29-2d1a-4637-ba4d-074671188bb3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">make -j 6</code></pre><p id="6bdcc21e-d9ec-4218-8f07-d3e679c14cc2" class="">After compiling the source code, now run the installation command in your terminal:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f83530c9-3c06-40d3-ae35-d282aa61529d" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo make install</code></pre><p id="13ac7d1b-beba-4603-96a8-940455479335" class="">Note, the installation is done in the <strong>/usr/local/modsecurity/,</strong> which you will reference later in the guide.</p><h2 id="a219e041-7ef2-41e4-aea7-eb1977bc9e3e" class=""><strong>Install ModSecurity-nginx Connector</strong></h2><p id="98319553-96c2-416b-be0a-8ca3bf84596f" class="">The <strong>ModSecurity-nginx connector</strong> is the connection point between <strong>nginx</strong> and <strong>libmodsecurity.</strong> It is the component that communicates between Nginx and ModSecurity <strong>(libmodsecurity3)</strong>.</p><h3 id="b62055c0-d232-417b-b54a-202136618193" class="">Clone ModSecurity-nginx Repsoitory from Github</h3><p id="6afde200-a190-4c7b-a0b9-7e9c0622c6ac" class="">Similar to the previous step cloning the libmodsecurity3 repository, you will need to clone the connector repository again using the following command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8d6fe303-2d04-4353-90aa-47ea357fcdb6" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo git clone --depth 1 https://github.com/SpiderLabs/ModSecurity-nginx.git /usr/local/src/ModSecurity-nginx/</code></pre><h3 id="0239a752-124d-45b7-ad83-d27efc62b162" class="">Install ModSecurity-nginx Dependencies</h3><p id="b6195e35-63f2-4609-a83a-ac595f9c4cd9" class="">Next, CD directory into the Nginx source directory as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="01086f44-d5a1-40bc-8dd8-4afb00dd4b09" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">cd /usr/local/src/nginx/nginx-1.21.1</code></pre><p id="f59698cc-d076-48ff-8be6-2b8eb56fe896" class="">Note, replace the version of the guide with the current Nginx version in your system.</p><p id="126d8458-aaeb-4918-9896-711886c89f76" class="">Now, run the command in your Ubuntu terminal to install the dependencies required:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2fce2983-8726-4fff-a2a0-3025f3881fde" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo apt build-dep nginx &amp;&amp; sudo apt install uuid-dev -y</code></pre><p id="6f2eba16-e6da-4c3b-9421-2c360a4bd010" class="">Next, you will compile the <strong>ModSecurity-nginx Connector</strong> module only with the <strong>–with-compat</strong> flag as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d481d802-349c-4950-98e7-c4e12ef4ed00" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo ./configure --with-compat --add-dynamic-module=/usr/local/src/ModSecurity-nginx</code></pre><p id="1bd93f50-115d-4d0b-95a9-5b3ccf9b2829" class="">Now <strong>make</strong> (create) the dynamic modules with the following command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4c5b1df5-cbd3-4e16-afff-bcb092cd4541" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo make modules</code></pre><p id="76a29fbe-d449-4e5c-9200-0ecb3932ebb3" class="">Next, while in the Nginx source directory, use the following command to move the dynamic module you just created that was saved at the location <em><strong>objs/ngx_http_modsecurity_module.so</strong></em> and copy it to the <em><strong>/usr/share/nginx/modules</strong></em> directory.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0ff0a892-da15-4d9d-972b-61938bf5d574" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo cp objs/ngx_http_modsecurity_module.so /usr/share/nginx/modules/</code></pre><p id="876b7ac2-060f-4b3e-9301-7b1d4913801b" class="">You can store the dynamic module anywhere, as long as you specify the full path when loading.</p><h2 id="f3f6a48c-4db0-40f4-9a79-ce03c0672629" class=""><strong>Load and Configure ModSecurity-nginx Connector with Nginx</strong></h2><p id="cfbb84ae-f8d7-43df-a91b-21c196080885" class="">Now that you have compiled the dynamic module and located it accordingly, you need to edit your <em><strong>/etc/nginx/nginx.conf</strong></em> configuration file to get ModSecurity operating with your Nginx webserver.</p><h3 id="bc1b278d-8d75-4dec-acdc-d94f5cb295a9" class="">Enable ModSecurity in nginx.conf</h3><p id="9ea75897-bf0f-4ca0-bc8a-e146d995aa37" class="">Firstly, you need to specify <strong>load_module</strong> and path to your modsecurity module.</p><p id="b2c16f53-f450-4535-ad64-d1685d782810" class="">Open up <strong>nginx.conf </strong>with any text editor. For the tutorial, nano will be used:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b97b3f49-b881-46ef-b41e-211241d86025" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/nginx/nginx.conf</code></pre><p id="012915fe-3ecf-4845-8411-e39bef640947" class="">Next, add the following line to the file near the top:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3ab33cb4-0f31-4198-b601-1031f5ca52f4" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">load_module modules/ngx_http_modsecurity_module.so;</code></pre><p id="66b95332-96da-404f-a5c8-815a836e1fb2" class="">If you have located the module elsewhere, make sure to include the full path.</p><p id="4edc1a1f-2497-47d1-a88f-5b1cf7be363d" class="">Now add the following code under the <strong>HTTP {}</strong> section as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="41ca6fa8-e06c-4c2c-b56e-72a3c2dd2ec7" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">modsecurity on;
modsecurity_rules_file /etc/nginx/modsec/modsec-config.conf;</code></pre><p id="5ad6cf0f-f5d4-4168-8421-a81bedf50a58" class=""><em>Example:</em></p><figure id="d3c9acd6-c7b1-453c-a3ed-ee3e888f01fb" class="image"><a href="https://www.linuxcapable.com/wp-content/uploads/2021/08/example-nginx.conf-for-modsecurity-install-ubuntu-20.04.png"><img src="https://www.linuxcapable.com/wp-content/uploads/2021/08/example-nginx.conf-for-modsecurity-install-ubuntu-20.04.png"/></a></figure><p id="ff90e8c9-35eb-435a-9ae7-43ba36b4529a" class="">If you have located the module elsewhere, make sure to include the full path.</p><p id="7bede826-c7d2-48e3-a362-fdf6690b0014" class="">Save the <strong>nginx.conf</strong> file <strong>(CTRL+O), </strong>then exit <strong>(CTRL+X)</strong>.</p><h3 id="d12f032f-c82b-4a21-8a25-964e4dc00f53" class="">Create and Configure Directory and Files for ModSecurity</h3><p id="7a154d4c-5e03-4c9c-8be4-8c37848d5161" class="">You will need to create a directory to store the configuration files and future rules, OWASP CRS for the tutorial.</p><p id="13ed57fc-3aa6-41d7-9245-d6b37d5b2c02" class="">Use the following command to create the <em><strong>/etc/nginx/modsec</strong></em> directory as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="350ef5be-1bc5-4865-90fd-1d405d4c140c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo mkdir /etc/nginx/modsec/</code></pre><p id="833da361-46c1-40e3-8875-53e02550cdb8" class="">Now, you need to copy the sample ModSecurity configuration file back from our cloned GIT directory:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2cd6e9df-818a-4d0f-93fd-fcdd9097bf34" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo cp /usr/local/src/ModSecurity/modsecurity.conf-recommended /etc/nginx/modsec/modsecurity.conf</code></pre><p id="1d7d8baa-ff06-4b4b-bf33-6d855933782a" class="">Using your favorite text editor in Ubuntu, open the modsecurity.conf file as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a0370a48-afa2-48f6-8fe4-f5e36a65c18f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/nginx/modsec/modsecurity.conf</code></pre><p id="4d8e16ab-4d13-422e-aa24-e4a83fcea91d" class="">By default, ModSecurity configuration has the rule engine specified as <strong>(DetectionOnly)</strong>, which in other words, runs ModSecurity and detects all malicious behavior but does not action blocks or bans and logs all the HTTP transactions that it flags. This should only be used if you have lots of false positives or have increased the security level settings to an extreme level and testing to see if any false positives occur.</p><p id="d9f8e985-e154-4cf9-b00a-5c2867effff8" class="">To change this behavior to <strong>(on)</strong>, find the following on <strong>line 7</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="31edca19-1859-4f4f-b60d-e8ad331e1372" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecRuleEngine DetectionOnly</code></pre><p id="082faeb3-6894-4df3-b3b3-7742cbfb63ab" class="">Change the line to this to enable ModSecurity:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8ce089a7-13a2-4440-99ce-3774be21f7e2" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecRuleEngine On</code></pre><p id="5be0ea37-a315-4dd5-9a20-c593c9ebf037" class="">Now, you need to locate the following, which is located on <strong>line 224</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="26bf2c56-b876-416a-94c8-5ce661209e4d" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"># Log everything we know about a transaction.
SecAuditLogParts ABIJDEFHZ</code></pre><p id="e84932a6-a21d-4c05-b85b-6a41d9e3ce82" class="">This isn’t correct and needs to be changed. Modify the line to the following:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c5ccb02c-92b9-4932-9449-e5348d920808" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecAuditLogParts ABCEFHJKZ</code></pre><p id="d6f1545e-49e6-4ab2-960f-8e96ad511c05" class="">Now save the <strong>modsecurity.conf </strong>file using <strong>(CTRL+O)</strong> then exit <strong>(CTRL+X)</strong>.</p><p id="fbb56f65-d535-4ef2-baa9-3a7ded7082cf" class="">The next part is to create the following file <strong>modsec-config.conf</strong>. Here you will add the <strong>modsecurity.conf </strong>file along and later on other rules such as <strong>OWASP CRS</strong>, and if you are using WordPress, the <strong>WPRS CRS</strong> rule set.</p><p id="96570757-8f48-4d77-b3da-b119663ee521" class="">Use the following command to create the file and open it:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7b738d8f-38f8-447f-a30b-718b67f6fcec" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/nginx/modsec/modsec-config.conf</code></pre><p id="427b67e5-fc91-42f6-b9e1-fa80423daa47" class="">Once inside the file, add the following line:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9b8e3fd8-20bb-40f5-9457-fff454372560" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Include /etc/nginx/modsec/modsecurity.conf</code></pre><p id="0b468546-3f30-45a5-8bad-5ec729ce6ead" class="">Save the <strong>modsec-config.conf</strong> file with <strong>(CTRL+O)</strong> then <strong>(CTRL+X)</strong> to exit.</p><p id="60d36c1a-6320-410c-971f-3f34a8f94fed" class="">Lastly, copy ModSecurity’s <strong>unicode.mapping</strong> file with the <strong>CP</strong> command as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="bc98c8d4-2f6c-4a03-8649-2032002ce0ad" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo cp /usr/local/src/ModSecurity/unicode.mapping /etc/nginx/modsec/</code></pre><p id="a8c4e84f-6227-4c13-937b-701fdfe8fe42" class="">Now before moving on, you should give your Nginx service a dry run with the following terminal command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7ee9d5c6-6fc6-4482-997f-65a141117acc" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nginx -t</code></pre><p id="d7ffc542-86c1-4b1a-b98c-70446c464376" class="">If you have set everything up correctly, you should get the following output:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="05270ab7-03c6-4ccc-8799-41fab276e172" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful</code></pre><p id="b72f24a6-14fe-4b02-a875-db3db2343bb9" class="">To make the changes live, restart your Nginx service using the systemctl command:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="24a83f45-dd9c-488c-a0b5-5841f99f7750" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo systemctl restart nginx</code></pre><h2 id="083882b6-0fc5-4cad-9681-e7601bdbcbf8" class=""><strong>Install OWASP Core Rule Set for ModSecurity</strong></h2><p id="7a61e2e2-dbea-4899-8ef1-38d08767617e" class="">ModSecurity on its own does not protect your webserver, and you need to have rules. One of the most famous, respected, and well-known rules is the OWASP CRS rule set. The rules are the most widely used amongst web servers and other WAFs, and most other similar systems base most of their rules off this CRS. Installing this ruleset will automatically give you a great source of protection against most emerging threats on the Internet by detecting malicious actors and blocking them.</p><p id="365ea959-fbd2-4241-8341-f3fd0023e695" class="">Using the <strong>wget command,</strong> download the <strong>OWASP CRS 3.3.2 archive</strong> as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4ee5e9b9-d9fa-4213-83a5-cef7f64ace4f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">wget https://github.com/coreruleset/coreruleset/archive/refs/tags/v3.3.2.zip</code></pre><p id="a7cc364b-ea4f-4215-a8c1-be6d778aab8b" class=""><strong>For those that want to live on the edge, you can download the nightly build. Only use the nightly if you are prepared to keep re-compiling and checking the CoreRuleSet Github frequently for updates and be more confident at figuring out issues. Technically the nightly can be more secure but potentially can create problems.</strong></p><p id="292a377b-7a22-480d-8a1e-324ff0790fe4" class=""><strong>For novice users, use the stable version and do not use the below version.</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="da35ee36-baeb-4d7a-965b-9b4664291577" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">wget https://github.com/coreruleset/coreruleset/archive/refs/tags/nightly.zip</code></pre><p id="058ce564-d57e-4121-8313-7b2d1f83b8d5" class="">Install the <strong>Unzip package</strong> if you do not have this installed on your server:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="d679e2d0-756d-42f9-be2a-92585ac064a3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo dnf install unzip -y</code></pre><p id="8ed1700d-4945-43a5-b3b6-be4946aae3ad" class="">Now <strong>unzip</strong> the <strong>master.zip</strong> archive as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2f340e4c-2d7f-4d30-bb68-c6c53d9998b7" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo unzip v3.3.2.zip -d /etc/nginx/modsec</code></pre><p id="595e039d-6bcf-481d-92bc-ad17d09aa85c" class="">As to before, like the <em><strong>modsecurity.conf</strong></em> sample configuration, <strong>OWASP CRS</strong> comes with a sample configuration file that you need to rename. It is best to use the <strong>CP</strong> <strong>command</strong> and keep a backup for the future in case you need to restart again.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="61eef5fc-f8cf-42f9-8f4d-f4feb1e832b3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo cp /etc/nginx/modsec/coreruleset-3.3.2/crs-setup.conf.example /etc/nginx/modsec/coreruleset-3.3.2/crs-setup.conf</code></pre><p id="edba2334-b476-4181-8e8f-e0e0f371b578" class="">To enable the rules, open the <strong>/etc/nginx/modsec/modsec-config.conf</strong> using any text editor again:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="86566631-ef9d-41b4-9560-8100dcc8cf33" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/nginx/modsec/modsec-config.conf</code></pre><p id="4e915241-cbfd-440e-a96b-4c8b19dfd787" class="">Once inside the file again, add the following two additional lines:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="27e62fbf-ab0a-4f0a-9cbd-986a233c4cd2" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">Include /etc/nginx/modsec/coreruleset-3.3.2/crs-setup.conf
Include /etc/nginx/modsec/coreruleset-3.3.2/rules/*.conf</code></pre><p id="97547542-398d-4008-a2ac-cbf2d07ec1a3" class="">Save the file <strong>(CTRL+O)</strong> and exit <strong>(CTRL+T)</strong>.</p><p id="e5ac4c73-6093-46ba-bfb6-a1911cf9de46" class="">As per before, you need to test any new additions to your Nginx service before making it live:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fbdec082-19e2-4b61-a3b9-68a116345317" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nginx -t</code></pre><p id="42f7d2ee-a5c8-4d9b-aa7b-1bd2f92562bd" class="">After running the dry-run test, you should get the following output which means everything is correctly working:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f7e110b6-c9cf-4847-8fcf-f83a533d16a3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful</code></pre><p id="aeccacf6-64a5-4199-9dce-166cf0b9c01a" class="">Restart your Nginx service to make the changes live as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="dee49ac9-d1a5-4211-90bc-1709b7f9e36e" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo systemctl restart nginx</code></pre><h2 id="39321c32-fb2c-4cba-b79e-3c0a48c7cae3" class=""><strong>Using and Understanding OWASP Core Rule Set</strong></h2><p id="c38a1be2-2e50-46f2-aa3c-5f65d591bc02" class="">OWASP CRS has quite a lot of options, the default settings, however, out of the box, will protect most servers immediately without hurting your real visitors and good SEO bots. Below, some areas will be covered to help explain. Further reading would be best to investigate all the options in the configuration files themselves as they have quite a bit of text data to explain what they are.</p><p id="604dac78-f292-4a92-aa42-1f0427d3aaa4" class="">Open up your <strong>CRS-setup.conf</strong> file as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ed2771de-7fab-4175-8fd8-1d4dcc947930" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/nginx/modsec/coreruleset-3.4-dev/crs-setup.conf</code></pre><p id="0a60fa06-bc8d-40b5-a9f0-eb09d96e3d37" class="">Note, this is the dev version configuration with additional items compared to version 3.3.</p><p id="b90f1676-6099-41f9-8ccc-6496c913e25a" class="">From here, you can modify most of your OWASP CRS settings.</p><h3 id="7f17a4b6-99ff-494e-b6e9-ca4079290bf4" class="">OWASP CRS Scoring</h3><p id="15161394-b427-4812-873c-8409e0784f1f" class="">To break it down, ModSecurity has two modes:</p><p id="b0608ef8-ed55-4408-ba4f-e1cb37b69ef5" class=""><strong>Anomaly Scoring Mode</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="20642b38-df33-4141-85cd-43c4712e4175" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"># -- [[ Anomaly Scoring Mode (default) ]] --
# In CRS3, anomaly mode is the default and recommended mode, since it gives the
# most accurate log information and offers the most flexibility in setting your
# blocking policies. It is also called &quot;collaborative detection mode&quot;.
# In this mode, each matching rule increases an &#x27;anomaly score&#x27;.
# At the conclusion of the inbound rules, and again at the conclusion of the
# outbound rules, the anomaly score is checked, and the blocking evaluation
# rules apply a disruptive action, by default returning an error 403.</code></pre><p id="b0b08ebc-9277-4445-84e6-0df236ceff23" class=""><strong>Self-Contained Mode</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c79c923c-c67f-4f67-a2c2-dbf21dd963b6" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"># -- [[ Self-Contained Mode ]] --
# In this mode, rules apply an action instantly. This was the CRS2 default.
# It can lower resource usage, at the cost of less flexibility in blocking policy
# and less informative audit logs (only the first detected threat is logged).
# Rules inherit the disruptive action that you specify (i.e. deny, drop, etc).
# The first rule that matches will execute this action. In most cases this will
# cause evaluation to stop after the first rule has matched, similar to how many
# IDSs function.</code></pre><p id="7b2370fc-332a-47b2-8aa4-dc8f2ef357e8" class="">Anomaly Scoring is generally for most users the best mode to use.</p><p id="2811d4a1-709b-40ee-9b9b-bee2d09ec57b" class="">There are four paranoia levels:</p><ul id="4bed2fc9-d3b4-40ec-a342-c57a66ba2bfa" class="bulleted-list"><li style="list-style-type:disc"><strong>Paranoia Level 1 –</strong> Default level and recommended for most users.</li></ul><ul id="afa4e86c-17dc-4921-a323-8c73fb611bf6" class="bulleted-list"><li style="list-style-type:disc"><strong>Paranoia Level 2 –</strong> Advanced users only.</li></ul><ul id="48af09a0-5226-48c7-a9d2-230caf227a52" class="bulleted-list"><li style="list-style-type:disc"><strong>Paranoia Level 3 –</strong> Expert users only.</li></ul><ul id="e7b22197-f72a-44b6-9052-50491aa1bc9e" class="bulleted-list"><li style="list-style-type:disc"><strong>Paranoia Level 4 –</strong> Not recommended at all, except for exceptional circumstances.</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="499b8763-63c5-4a9b-a51b-0f742765cc8c" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all"># -- [[ Paranoia Level Initialization ]] ---------------------------------------
#
# The Paranoia Level (PL) setting allows you to choose the desired level
# of rule checks that will add to your anomaly scores.
#
# With each paranoia level increase, the CRS enables additional rules
# giving you a higher level of security. However, higher paranoia levels
# also increase the possibility of blocking some legitimate traffic due to
# false alarms (also named false positives or FPs). If you use higher
# paranoia levels, it is likely that you will need to add some exclusion
# rules for certain requests and applications receiving complex input.
#
# - A paranoia level of 1 is default. In this level, most core rules
#   are enabled. PL1 is advised for beginners, installations
#   covering many different sites and applications, and for setups
#   with standard security requirements.
#   At PL1 you should face FPs rarely. If you encounter FPs, please
#   open an issue on the CRS GitHub site and don&#x27;t forget to attach your
#   complete Audit Log record for the request with the issue.
# - Paranoia level 2 includes many extra rules, for instance enabling
#   many regexp-based SQL and XSS injection protections, and adding
#   extra keywords checked for code injections. PL2 is advised
#   for moderate to experienced users desiring more complete coverage
#   and for installations with elevated security requirements.
#   PL2 comes with some FPs which you need to handle.
# - Paranoia level 3 enables more rules and keyword lists, and tweaks
#   limits on special characters used. PL3 is aimed at users experienced
#   at the handling of FPs and at installations with a high security
#   requirement.
# - Paranoia level 4 further restricts special characters.
#   The highest level is advised for experienced users protecting
#   installations with very high security requirements. Running PL4 will
#   likely produce a very high number of FPs which have to be
#   treated before the site can go productive.
#
# All rules will log their PL to the audit log;
# example: [tag &quot;paranoia-level/2&quot;]. This allows you to deduct from the
# audit log how the WAF behavior is affected by paranoia level.
#
# It is important to also look into the variable
# tx.enforce_bodyproc_urlencoded (Enforce Body Processor URLENCODED)
# defined below. Enabling it closes a possible bypass of CRS.</code></pre><h3 id="cde8e78b-a10c-42ab-b6bc-5a12547d52a4" class="">Test OWASP CRS on your Server</h3><p id="60cc7e9d-f3bb-44c7-96b1-fad1d8c6229b" class="">To test if OWASP CRS is working on your server, open up your Internet Browser and use the following:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="5e8d61db-4a44-4143-a5db-b311d47861e4" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">https://www.yourdomain.com/index.html?exec=/bin/bash</code></pre><p id="f022547f-cd8a-460f-aae6-eb5798d9406e" class="">You should receive a <strong>403 forbidden error.</strong> If not, then a step has been missed.</p><p id="90c86dd9-80df-4f66-89e6-13cf6cba7759" class="">The most common problem is missing to change <strong>DetectionOnly</strong> to <strong>On,</strong> as covered earlier in the tutorial.</p><h3 id="b88ff485-e69f-41f3-a84d-a04568a63601" class="">Dealing with False Positives &amp; Custom Rules Exclusion</h3><p id="121b01f2-4caa-414f-a62e-0ca2769c1c17" class="">One of the often never-ending tasks is dealing with false positives, ModSecurity and OWASP CRS do a great job together, but it comes at the cost of your time, but given the protection, you get it is worth it. For starters, never put the paranoia level up high to start with is the golden rule.</p><p id="85a401ff-5958-4f41-b1a3-8ec14043e01e" class="">A good rule of thumb is to run the rule set for a few weeks to months with hardly any false positives, then increase, for example, paranoia level 1 to paranoia level 2, so you are not swamped with a ton simultaneously.</p><h1 id="bf7a8fa2-afae-489c-b1da-6130760eb670" class="">Excluding False Positives known Applications</h1><p id="e766ab32-77d0-47de-a970-0fcd6f456d35" class="">Modsecurity, by default, can whitelist everyday actions that lead to false positives as below:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="34752ce8-17ae-4c65-a5e9-3ab558b97c36" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">#SecAction \
# &quot;id:900130,\
#  phase:1,\
#  nolog,\
#  pass,\
#  t:none,\
#  setvar:tx.crs_exclusions_cpanel=1,\
#  setvar:tx.crs_exclusions_dokuwiki=1,\
#  setvar:tx.crs_exclusions_drupal=1,\
#  setvar:tx.crs_exclusions_nextcloud=1,\
#  setvar:tx.crs_exclusions_phpbb=1,\
#  setvar:tx.crs_exclusions_phpmyadmin=1,\
#  setvar:tx.crs_exclusions_wordpress=1,\
#  setvar:tx.crs_exclusions_xenforo=1&quot;</code></pre><p id="796a23f9-423f-4c3a-aa8f-854e2b3bea07" class="">To enable, for example, <strong>WordPress, phpBB, and phpMyAdmin</strong> as you use all three, <strong>uncomment the lines</strong> and leave the <strong>(1)</strong> number intact, change the other services you do not use, for instance, Xenforo to <strong>(0)</strong> as you do not want to whitelist these rules. Example below:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4c4c333f-445a-47d8-bac1-52441d7338f7" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecAction \
 &quot;id:900130,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_exclusions_cpanel=0,\
  setvar:tx.crs_exclusions_dokuwiki=0,\
  setvar:tx.crs_exclusions_drupal=0,\
  setvar:tx.crs_exclusions_nextcloud=0,\
  setvar:tx.crs_exclusions_phpbb=1,\
  setvar:tx.crs_exclusions_phpmyadmin=1,\
  setvar:tx.crs_exclusions_wordpress=1,\
  setvar:tx.crs_exclusions_xenforo=0&quot;</code></pre><p id="ea8148c2-c0ad-431e-818e-558fbd5eb167" class="">You can also modify the syntax, which would be cleaner. For example:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="379b4704-e346-4183-8aa6-14f482e33357" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecAction \
 &quot;id:900130,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_exclusions_phpbb=1,\
  setvar:tx.crs_exclusions_phpmyadmin=1,\
  setvar:tx.crs_exclusions_wordpress=1&quot;</code></pre><p id="9b4314e5-f8f9-4506-82cd-756ba8dfde7b" class="">As you can see, removed are the options not needed, and added <strong>(“) </strong>at the end of WordPress for correct syntax.</p><h3 id="6b00bf4d-215a-41a8-9fa6-cc2a40bf18a4" class="">Excluding Rules in Before CRS</h3><p id="1d62a175-00a5-48b4-ae7b-e86d1c7ad1b3" class="">To deal with custom exclusions, firstly, you need to change the name from the <strong>REQUEST-900-EXCLUSION-RULES-BEFORE-CRS-SAMPLE.conf</strong> file with the <strong>cp command</strong> as follows:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c483d8aa-37d1-45bb-9f10-3eecb08a8804" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo cp /etc/nginx/modsec/coreruleset-3.4-dev/rules/REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf.example /etc/nginx/modsec/coreruleset-3.4-dev/rules/REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf</code></pre><p id="37e15e1e-0947-435b-a94c-ca5e11070796" class="">A point to remember, when creating exclusion rules, each one must have id:&lt;rule number&gt; and be unique, or else when your test your Nginx service, you will get an error. Example <em><strong>“id:1544,phase:1,log,allow,ctl:ruleEngine=off”</strong></em>, the id 1544 cannot be used for a second rule.</p><p id="d7c5d75c-8ad7-426f-a083-8e13f4d80ede" class="">For example, some REQUEST_URI’s will raise false positives. The example below is two with Google pagespeed beacon and WMUDEV plugin for WordPress:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cf6f950a-7b76-4102-9000-e8b5efb79edf" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecRule REQUEST_URI &quot;@beginsWith /wp-load.php?wpmudev&quot; &quot;id:1544,phase:1,log,allow,ctl:ruleEngine=off&quot;

SecRule REQUEST_URI &quot;@beginsWith /ngx_pagespeed_beacon&quot; &quot;id:1554,phase:1,log,allow,ctl:ruleEngine=off&quot;</code></pre><p id="75ee2f52-5c1a-42f6-a1f1-4e5bf882bcae" class="">As you can see, any URL that begins with the path will be automatically allowed.</p><p id="ea711d6f-962f-4fd4-bfa9-f8ea66a65999" class="">Another option is to whitelist IP addresses, a few ways you can go about this:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b1730e95-7e72-41c6-beb6-3df2ff8878a6" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecRule REMOTE_ADDR &quot;^195\.151\.128\.96&quot; &quot;id:1004,phase:1,nolog,allow,ctl:ruleEngine=off&quot;
## or ###
SecRule REMOTE_ADDR &quot;@ipMatch 127.0.0.1/8, 195.151.0.0/24, 196.159.11.13&quot; &quot;phase:1,id:1313413,allow,ctl:ruleEngine=off&quot;</code></pre><p id="37d3012a-926b-4ad0-8460-2b51ecff28ea" class="">The <strong>@ipMatch </strong>can be used more extensively for subnets. If you want to deny a <strong>subnet</strong> or <strong>IP address</strong> change, allow to deny. You can also, with a bit of know-how, create blacklists and whitelists and configure this with <strong>fail2ban</strong>. The possibilities can often be endless.</p><p id="2859280a-f43e-4b9b-ad83-46d1f0819fde" class="">One last example is to disable only rules that trigger false positives, not blanket whitelisting the entire path, as you saw with the first REQUEST_URI example. However, this takes more time and testing. For instance, you want to remove rules <strong>941000</strong> and <strong>942999</strong> from your /admin/ area as it keeps triggering false bans and blocks for your team, find in your modsecurity logs file the rule ID and then disable only that ID with <strong>RemoveByID</strong> as the example below:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="69bff05b-67db-4696-acba-60a09e1321e3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecRule REQUEST_FILENAME &quot;@beginsWith /admin&quot; &quot;id:1004,phase:1,pass,nolog,ctl:ruleRemoveById=941000-942999&quot;</code></pre><p id="03c06ff3-8819-4651-a3a1-a9b399ffb6f5" class="">Examples can be found on the ModSecurity GIT <strong><a href="https://github.com/SpiderLabs/ModSecurity/wiki">wiki page</a></strong>.</p><h3 id="9d974fd8-451f-41e6-92b5-3e6e5a3db9d7" class="">Optional – Include Project Honeypot</h3><p id="a8e799af-3454-4926-a85b-0868a2789d46" class=""><strong><a href="https://projecthoneypot.org/create_account.php">Project Honey Pot</a></strong> is the first and only distributed system for identifying spammers and the spambots they use to scrape addresses from your website. Using the Project Honey Pot system, you can install custom-tagged addresses to the time and IP address of a visitor to your site. If one of these addresses begins receiving email, we not only can tell that the messages are spam, but also the exact moment when the address was harvested and the IP address that gathered it.</p><p id="e1b02ca3-9ac6-4f73-bbc6-07424564696b" class="">ModSecurity can have the option to integrate Project Honeypot, which will query the database and block any addresses that are on the HoneyPot blacklist. Note, using this can lead to false positives. However, this is small as the data is reliable, but sometimes good bots mainly get flagged, so be careful.</p><p id="e39c7471-1152-4aa5-88e7-c9128276c3af" class=""><strong>Step 1.</strong> Create an account a <strong><a href="https://projecthoneypot.org/create_account.php">free account</a></strong>.</p><p id="92ba1a59-593f-4543-8a0e-16f4223c0531" class=""><strong>Step 2.</strong> Once you have signed up and logged in, on the dashboard, find the line <strong>(Your http:BL API key)</strong> and click <strong>get one</strong>.</p><figure id="cc4b6822-02b3-4074-8583-888bc6a27770" class="image"><a href="https://www.linuxcapable.com/wp-content/uploads/2021/08/project-honeypot-front-page.png"><img src="https://www.linuxcapable.com/wp-content/uploads/2021/08/project-honeypot-front-page.png"/></a></figure><p id="597d15d7-507c-42c7-99db-0b6e0758928d" class=""><strong>Step 3.</strong> Go back to the <strong>CRS-setup.conf</strong> file by opening it using a text editor:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a6ed586f-b641-496d-80a6-3b91400e8797" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/nginx/modsec/coreruleset-3.3.2/crs-setup.conf</code></pre><p id="7ee69df8-d462-44f3-9829-81f74ec6ede7" class=""><strong>Step 4.</strong> Find the line starting with <strong>#SecHttpBlKey,</strong> which is on line 629.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="45463230-70c1-4e53-9bf0-d4ff57dec06a" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">#SecHttpBlKey XXXXXXXXXXXXXXXXX
#SecAction &quot;id:900500,\
#  phase:1,\
#  nolog,\
#  pass,\
#  t:none,\
#  setvar:tx.block_search_ip=1,\
#  setvar:tx.block_suspicious_ip=1,\
#  setvar:tx.block_harvester_ip=1,\
#  setvar:tx.block_spammer_ip=1&quot;</code></pre><p id="e58152df-e6ad-4a54-af8e-85ff6c6b6992" class=""><strong>Step 5.</strong> Change the SecHttpBlKey XXXXXXXXXXXXXXXXX with your key from Project HoneyPot.</p><p id="76fbcff2-72a4-4e22-8ebb-d705cadcec62" class=""><em>Example:</em></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0a60fdff-0f40-4d36-a215-e0c177d76b9d" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecHttpBlKey amhektvkkupe</code></pre><p id="222d1786-fcc6-4be6-a80a-c5e22dab3057" class=""><strong>Step 6.</strong> Next, uncomment all the lines to enable the rule. If you want to deactivate a rule, instead of <strong>(1),</strong> put <strong>(0) </strong>instead if you wish to have any of the rules disabled. By default, block_search_ip=0 is for search engine bots, do not enable this unless you want Bing, Google, and other good bots coming to your site.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cd177c84-7cff-4388-99eb-6c374df741a6" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">SecHttpBlKey amhektvkkupe
SecAction &quot;id:900500,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.block_search_ip=0,\
  setvar:tx.block_suspicious_ip=1,\
  setvar:tx.block_harvester_ip=1,\
  setvar:tx.block_spammer_ip=1&quot;</code></pre><p id="aca6312d-ffdc-49a1-96a9-fa2b7d1ecdc8" class="">Note, do not use <strong>amhektvkkupe. Use</strong> your key instead!</p><p id="b6ff8af0-8683-4c23-9357-3ae4e5b4dec5" class=""><strong>Step 7.</strong> Test Nginx to make sure no errors have occurred with the following:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c3045a44-2144-453d-8e20-efa13f8c3447" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nginx -t</code></pre><p id="88f07a92-5787-47a4-b62c-1c0cc444d484" class=""><em>Example output if all correct:</em></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f3fba68f-5d58-44fb-9575-603648ddfcad" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful</code></pre><p id="96e4c999-d658-4fb2-a35b-92257b908b41" class="">Now restart your Nginx service:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="62b73221-027b-4aa4-b41b-7a1dbdadb52f" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo systemctl restart nginx</code></pre><h2 id="cf228a10-f51e-42a2-b38e-e84e83b21bfd" class=""><strong>WordPress WPRS Rule Set for ModSecurity</strong></h2><p id="358e0d97-0d71-480f-9e74-e675de1273e3" class="">Another option for <strong>WordPress</strong> users is to install and run alongside your OWASP CRS rule set, a well-known project entitled WPRS rule set. As this is optional and isn’t for everyone, the tutorial will not cover it in this section.</p><p id="408a2b6a-43f4-477b-b7c4-7867fde5d0be" class="">However, if you would like to install this for extra protection if you use WordPress on your server, please visit our tutorial on <strong><a href="https://www.linuxcapable.com/how-to-install-wordpress-modsecurity-rule-set-wprs/">Installing WordPress ModSecurity Rule Set (WPRS)</a></strong>.</p><h2 id="7d907fbe-a1ee-4c1c-a09e-e0ff8a0e9fed" class=""><strong>Create ModSecurity LogRotate file:</strong></h2><p id="18e2ec56-d80f-4b0d-bd6d-f0cddb9e275b" class="">ModSecurity logs can grow quite quickly. As you are compiling the module and it isn’t installed through any official repository from Ubuntu, you will need to create your own log rotate file.</p><p id="50ed272c-f67a-4389-9f24-d80df1b325f9" class="">First, create and open your ModSecurity rotate file <strong>modsec</strong>:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ef746df7-a837-42e1-95f4-bcc1504cfdce" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">sudo nano /etc/logrotate.d/modsec</code></pre><p id="ece0573b-9288-497b-96a4-e031413fd304" class="">Add the following code:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c25a34b5-fb58-4adc-a8eb-70980a4281eb" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">/var/log/modsec_audit.log
{
        rotate 31
        daily
        missingok
        compress
        delaycompress
        notifempty
}</code></pre><p id="6e9acbf2-3a4f-4353-a004-59ea2815c168" class="">This will keep logs for<strong> 31</strong> days. If you prefer to have less, change <strong>31</strong> to say <strong>7</strong> days equally a week’s worth of logs. You should be rotating daily for ModSecurity. If you need to review the log files having a weekly file will be a disaster to sift through, given how large it will be.</p><h2 id="14ac60b2-86ee-423b-bbb4-0ac46882edee" class=""><strong>Comments and Conclusion</strong></h2><p id="dfee5fd1-80e6-4ca4-a77a-31c54808a235" class="">In the tutorial, you have a grasp of installing the Nginx source, compiling ModSecurity, and setting up the OWASP Rules amongst the top parts. Overall, deploying ModSecurity to your server will provide instant protection. However, patience, time, and dedication in learning will be such a great feature. The last thing you want is to block SEO bots or, more importantly, real users that could be potential customers.</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>