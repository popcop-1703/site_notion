<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Материал лекции</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 237, 214, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(249, 228, 188, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="05c6ce4e-9ef4-46b7-9beb-d2b2c9181d4f" class="page sans"><header><h1 class="page-title">Материал лекции</h1><p class="page-description"></p></header><div class="page-body"><h2 id="b0dbdab5-23a0-437b-ab42-ae89379a0b37" class="">Firewall</h2><figure class="block-color-teal_background callout" style="white-space:pre-wrap;display:flex" id="fcd7b338-c069-4aae-8e38-cdb5163ce2e4"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Firewall (межсетевой экран, брандмауэр) осуществляет контроль и фильтрацию проходящего через него сетевого трафика в соответствии с заданными правилами. </div></figure><figure id="f4d62c0b-7fbd-4f35-bcf5-8bff3654278b" class="image"><a href="%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%20%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%2005c6ce4e9ef446b79bebd2b2c9181d4f/Untitled.png"><img style="width:1540px" src="%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%20%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%2005c6ce4e9ef446b79bebd2b2c9181d4f/Untitled.png"/></a><figcaption>Когда пакет данных перемещается в защищенное сетевое пространство или из него, то его содержимое (информация о его происхождении, цели и протоколе) проверяется на соответствие с правилами, чтобы определить, следует ли его пропускать или нет.</figcaption></figure><h3 id="ccf187a1-3509-4406-9dc9-834829bc3d02" class="">Iptables</h3><p id="2d1bf191-6790-4045-8266-2601c078e7a0" class="">Iptables является <strong>утилитой Linu</strong>x, выполняющей функции <strong>межсетевого экрана</strong>. Настройка iptables производится в командной строке, с помощью правил iptables можно разрешать или блокировать прохождение трафика. </p><figure id="27145c36-c3f3-4a18-a471-cf608da3c3ab" class="image"><a href="%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%20%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%2005c6ce4e9ef446b79bebd2b2c9181d4f/Untitled%201.png"><img style="width:671px" src="%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%20%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%2005c6ce4e9ef446b79bebd2b2c9181d4f/Untitled%201.png"/></a><figcaption>Основные понятия</figcaption></figure><h3 id="bc10f7dc-430b-447e-9a5b-e0882a2c4f9d" class="">Виды пакетов</h3><blockquote id="f00c7cce-e248-472a-b0ec-03e46d449120" class="">Все пакеты делятся на три типа: входящие, исходящие и проходящие.</blockquote><ul id="6eeaff6a-b771-427b-8fc3-645f93b33269" class="bulleted-list"><li style="list-style-type:disc"><strong>Input</strong> - обрабатывает входящие пакеты и подключения. <br/>Например, если какой-либо внешний пользователь пытается подключиться к<br/>вашему компьютеру по ssh.<br/></li></ul><ul id="04fed574-2095-472d-8a63-5ffbebdf6ce6" class="bulleted-list"><li style="list-style-type:disc"><strong>forward</strong> - эта цепочка применяется для проходящих<br/>соединений.<br/>Сюда попадают пакеты, которые отправлены на ваш компьютер,<br/>но не предназначены ему.<br/></li></ul><ul id="a6126f57-6f82-4a6e-a3ca-6fbcd4235d85" class="bulleted-list"><li style="list-style-type:disc"><strong>output</strong> - эта цепочка используется для исходящих<br/>пакетов и соединений.<br/></li></ul><h3 id="7fb349eb-7d01-4dcf-aa24-acb1d907c1d3" class="">Таблицы ipatables</h3><p id="4f50b7c3-94f5-48af-850e-4100ce7ebe6c" class="">Над цепочками правил в iptables есть еще один уровень абстракции, и <br/>это таблицы.<br/></p><ul id="92922354-aea3-44e6-bbca-a203f3c69c3d" class="bulleted-list"><li style="list-style-type:disc"><strong>raw</strong> - предназначена для работы с сырыми пакетами, пока они еще не прошли обработку;</li></ul><ul id="4ec34966-ae0e-4ac6-8e19-43c2edc00654" class="bulleted-list"><li style="list-style-type:disc"><strong>mangle</strong> - предназначена для модификации пакетов;</li></ul><ul id="d4bab4c2-47f0-4e27-95fd-ba3e69742a92" class="bulleted-list"><li style="list-style-type:disc"><strong>nat</strong> - обеспечивает работу nat, если вы хотите использовать компьютер в качестве маршрутизатора;</li></ul><ul id="671b9e9c-c625-45d7-b1ef-3adadb3b549f" class="bulleted-list"><li style="list-style-type:disc"><strong>filter</strong> - основная таблица для фильтрации пакетов, используется по умолчанию.</li></ul><h3 id="142f49de-69b9-4dfe-9ff3-338c840bdf76" class="">Правила и действия (targets)</h3><table id="d61c0fb2-67fa-48db-9a92-4b0c951143cf" class="simple-table"><thead class="simple-table-header"><tr id="f0ecda81-2288-4152-8f93-3f5e9241909a"><th id="XVKB" class="simple-table-header-color simple-table-header">Правила</th><th id="Q`fk" class="simple-table-header-color simple-table-header" style="width:515px">Действие</th></tr></thead><tbody><tr id="6cd696e2-c32c-4e4f-b8ed-83dc27ea7c5c"><td id="XVKB" class=""><strong>ACCEPT</strong></td><td id="Q`fk" class="" style="width:515px">Разрешить прохождение пакета дальше по цепочке правил</td></tr><tr id="b94a67bd-6bbe-4e41-873d-b761610086e3"><td id="XVKB" class=""><strong>DROP</strong></td><td id="Q`fk" class="" style="width:515px">Удалить пакет</td></tr><tr id="57d0e530-d809-43b2-af16-2ac37a756412"><td id="XVKB" class=""><strong>REJECT</strong></td><td id="Q`fk" class="" style="width:515px">Отклонить пакет, отправителю будет отправлено сообщение, что пакет был отклонен</td></tr><tr id="09098353-1daf-4955-afa3-4f7f831bbdb7"><td id="XVKB" class=""><strong>LOG</strong></td><td id="Q`fk" class="" style="width:515px">Сделать запись о пакете в лог файл</td></tr><tr id="1a45bee5-03a7-4c42-a188-6d8c0b251399"><td id="XVKB" class=""><strong>QUEUE</strong></td><td id="Q`fk" class="" style="width:515px">Отправить пакет пользовательскому приложению</td></tr></tbody></table><h3 id="93481359-06f0-40b6-a76f-c5f2fd265a63" class="">Состояния соединений</h3><p id="6cf2baba-3510-446b-a44a-a04b8d7ba4f3" class="">Можно ограничивать подключения к службам на основе состояния их подключения.</p><ul id="4fd5d6a4-a320-4976-b8bf-588dfe3aad7f" class="bulleted-list"><li style="list-style-type:disc"><strong>NEW —</strong> Пакет, запрашивающий новое соединение, например, HTTP-запрос. </li></ul><ul id="40cb0f4a-b397-4286-b27d-569d358701d2" class="bulleted-list"><li style="list-style-type:disc"><strong>ESTABLISHED</strong> — Пакет, являющийся частью уже существующего соединения. </li></ul><ul id="372df7fb-7e08-49c8-907c-fb4ee3e34f9e" class="bulleted-list"><li style="list-style-type:disc"><strong>RELATED —</strong> Пакет, запрашивающий новое соединение, но являющийся частью существующего соединения. Например, FTP использует порт 21 для установления соединения, но данные передаются через другой порт (обычно порт 20). </li></ul><ul id="6e365163-2fcb-4b5e-8439-cf0e34d70637" class="bulleted-list"><li style="list-style-type:disc"><strong>INVALID</strong> — Пакет, который не является частью какого-либо соединения в таблице отслеживания соединений</li></ul><h2 id="a8ae8ae5-97a1-4f0c-867d-e871ae48a966" class="">Рядовые атаки OS Linux</h2><p id="00a22a1a-2926-4217-b566-06631091ff81" class="">
</p><p id="202dc034-94bb-45b2-8227-a1e9b5a02fe1" class=""><strong>Dos</strong></p><p id="628ec35d-f0fb-43ca-b6dd-9866408192c8" class="">DoS-атака подразумевает искусственно созданный поток запросов к онлайн-ресурсу или ответов к обеспечивающим его работу сервисам, цель которого — многократное увеличение нагрузки на сайт или сервер и выведение их из состояния нормальной работы.</p><p id="ff31c592-a971-4aac-9d1d-1f5e4ddba1c0" class="">
</p><p id="3edb9b0d-6f6f-4cdb-85a9-0e579f75a1cb" class=""><strong>DDoS</strong></p><p id="ea3a8c8b-4183-4695-af98-01db1a24b48d" class=""><strong>DDoS</strong>-атака является разновидностью обыкновенной DoS-атаки. Отличие DoS от DDoS в количестве задействованных устройств. В случае классической DoS для отправки запросов в сторону цели атаки используется, как правило, одно устройство.</p><p id="89324130-85e9-4b62-a92b-11635dc6341c" class="">В случае DDoS-атаки задача распределяется между большим количеством атакующих устройств, как правило, управляемых атакующим центром.</p><figure id="af6b2423-0f16-480d-a25f-d99a2b1d85ba" class="image"><a href="%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%20%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%2005c6ce4e9ef446b79bebd2b2c9181d4f/Untitled%202.png"><img style="width:1024px" src="%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%20%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B8%2005c6ce4e9ef446b79bebd2b2c9181d4f/Untitled%202.png"/></a></figure><h3 id="59c4ae2c-7efb-4c86-8e43-f7cc2f4bb2b4" class="">Классификация DDOS</h3><p id="9db3c119-faf0-43b4-86a4-653d43349da8" class=""><strong>Атаки уровня инфраструктуры</strong></p><p id="00c027b0-82b6-456e-be36-c87db07fe46f" class="">К атакам уровня инфраструктуры обычно относят атаки на <br/>уровнях 3 и 4. Это наиболее распространенный тип DDoS-атак, который <br/>включает в себя такие векторы, как SYN-флуд, и другие атаки отражения, <br/>такие как UDP-флуд. <br/><strong>Подобные атаки обычно массовые и направлены на то, <br/>чтобы перегрузить пропускную способность сети либо серверы приложений. <br/></strong></p><p id="3d31b5dc-9615-4f27-9d09-e84bb7df1d34" class=""><strong>Атаки уровня приложения</strong></p><p id="583c48c1-bca4-4b54-a1c0-794b6c1f18da" class="">Метод используется для вызова перегрузки элементов инфраструктуры сервера приложений. Выявить такую атаку сложно, так как ее трудно отличить от легитимного трафика. Пример — имитация просмотра страниц.</p><p id="e47ae9e0-c2ab-4b43-927f-2915697e46f3" class=""><strong>Атаки транспортного уровня</strong> </p><p id="a64844d8-b73b-4f39-8ebe-aac0e0d02513" class="">Это наиболее распространенный тип DDoS-атак, который включает в себя такие атаки, как SYN-флуд, UDP-флуд, ICMP-флуд и др. Подобные атаки обычно массовые и направлены на то, чтобы <strong>перегрузить пропускную способность сети либо серверы приложений.</strong></p><h2 id="6a6735a8-d50c-4253-9e92-fdd2f6e34709" class="">Методы защиты</h2><ul id="5f4cfebd-fe62-4ac0-8228-dc8272a7bc4b" class="bulleted-list"><li style="list-style-type:disc">Использование брандмауэра для приложений.</li></ul><ul id="b0fd31e0-49b2-4015-9d19-a72ef8564a6d" class="bulleted-list"><li style="list-style-type:disc">Cведение к минимуму количества возможных точек для атаки.</li></ul><ul id="f37f33a7-8a4a-4c2e-b52c-37c52613927f" class="bulleted-list"><li style="list-style-type:disc">Контроль входящего трафика посредством ACL.</li></ul><ul id="daac83f1-3035-4fce-9a52-72bf15203868" class="bulleted-list"><li style="list-style-type:disc">Конфигурирование сетевого оборудования для противодействовать DDoS-атакам.</li></ul><ul id="c875f8d7-5a05-4dc1-8518-4b3246012a85" class="bulleted-list"><li style="list-style-type:disc">Использование специализированных сервисов для защиты от DDoS-атак.</li></ul><h2 id="3baf4e43-667f-4958-9157-140108842118" class="">Брутфорс</h2><figure class="block-color-teal_background callout" style="white-space:pre-wrap;display:flex" id="694d0c22-4b51-40f8-9637-5fe51f8db0ae"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">Брутфорсом называется метод взлома учетных записей<strong> путем подбора паролей</strong> к ним. </div></figure><p id="3f0e926f-1541-4a6b-841d-8fdeb2113224" class="">Bruteforce переводится как “грубая сила”, что красноречиво описывает суть метода. Она заключается в последовательном автоматизированном переборе всех возможных комбинаций символов с целью рано или поздно найти правильную.</p><h3 id="b0d3fd13-45e0-41c4-b07a-c425e20b3c7a" class="">Методы защиты</h3><ul id="ed559ec7-1445-48eb-a999-2c9b4fdbd61f" class="bulleted-list"><li style="list-style-type:disc">Использовать надежные пароли. </li></ul><ul id="7850b805-6334-46a7-a8f1-108d3fb6fb6e" class="bulleted-list"><li style="list-style-type:disc">Пароли должны быть не только длинными, но и содержать специальные символы. Не использовать такие пароли как «qwerty123», «p@ssw0rd» и т.п. </li></ul><ul id="53b6a3eb-15d1-4e46-a875-0d93fd61bb79" class="bulleted-list"><li style="list-style-type:disc">Вместо пароля использовать авторизацию по ключу. </li></ul><ul id="c876fa60-dbd2-43c9-a3bf-076e34a1eda7" class="bulleted-list"><li style="list-style-type:disc">Отключить возможности входа в учетную запись root. </li></ul><ul id="c920e678-4e79-4767-879a-7cc48c0bcfab" class="bulleted-list"><li style="list-style-type:disc">Использовать двухфакторную систему аутентификации. Блокировка IP-адресов после определенного количества попыток входа.</li></ul><h2 id="5c985da6-9dd3-4354-8c95-fc15fbc87c10" class="">File2ban</h2><figure class="block-color-teal_background callout" style="white-space:pre-wrap;display:flex" id="78ebff82-a95a-4bc7-aa00-152abe0b1f73"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">File2ban - это еще один способ <strong>предотвратить взлом методом брутфорса</strong>.</div></figure><p id="f27ef071-e4e0-408d-b922-5d321ca4d06a" class="">Написан на языке программирования Python, может работать на POSIX-системах имеющих встроенный менеджер пакетов и брандмауэр, например, iptables.</p><p id="db8c33d9-2c9b-4c3e-97ff-674da25a1002" class="">Принцип работы fail2ban прост. Специальный сервис ищет в системных журналах (логах) записи о неудачных попытках аутентификации и при определенных условиях с помощью iptables блокирует IP-адреса, с которых ведется атака.</p><h3 id="2b48e273-3640-4fc4-b3e9-64b981305f34" class=""><strong>Установка</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="48f04233-b0fb-49ca-b61b-f0484c8ad857" class="code"><code class="language-Shell">$ apt-get install fail2ban</code></pre><h3 id="ec745602-a2ad-4259-83d5-534de6fa88a3" class="">Конфигурация</h3><p id="8f11812c-35d1-460b-9c37-5710994c9925" class="">Базовая защита SSH сервера от перебора паролей будет включена по умолчанию. </p><p id="b09f8c74-38b9-4c80-a233-b8560cb191fc" class="">У программы два основных файла конфигурации:</p><p id="88553fdd-976a-49ce-8fc5-5e7f0e021f9a" class=""><strong>/etc/fail2ban/fail2ban.conf</strong> - отвечает за настройки запуска процесса Fail2ban</p><p id="a9949a13-1217-40ca-9387-be2a7988d046" class=""><strong>/etc/fail2ban/jail.conf </strong>- содержит настройки защиты конкретных сервисов</p><p id="92843c52-6f67-4e1c-82b7-3052a0ff74d9" class="">Файл jail.conf поделён на секции, каждая секция отвечает за определённый сервис и тип атаки. Например секция [ssh] отвечает за защиту SSH от brute–force атак.Параметры из секции [DEFAULT] применяются ко всем секциям.</p><p id="1e050459-29e9-408b-9e8a-6ad154b23fe2" class=""><strong>Основные параметры файла jail.conf</strong></p><ul id="4342df82-a818-4386-9006-b44fa8c97dd6" class="bulleted-list"><li style="list-style-type:disc"><strong>ignoreip</strong> — IP–адреса, которые не должны быть заблокированы. Можно задать список IP-адресов разделённых пробелами, маску подсети, или имя DNS–сервера</li></ul><ul id="d49d472c-6a35-43c0-8ef6-ac992cc93746" class="bulleted-list"><li style="list-style-type:disc"><strong>bantime</strong> — время бана в секундах, по истечении которого IP–адрес удаляется из списка заблокированных</li></ul><ul id="1c4adc82-a233-467b-881e-650e9a1b9814" class="bulleted-list"><li style="list-style-type:disc"><strong>maxretry</strong> — количество подозрительных событий, после которых применяется правило. В контексте брутфорса — это число неудавшихся попыток логина, после которых происходит блокировка.</li></ul><ul id="019a77f3-bc5f-4313-a691-81b6c8e5da0f" class="bulleted-list"><li style="list-style-type:disc"><strong>enabled</strong> — значение указывает что данный jail активен, выключает действие изолятора</li></ul><ul id="10874967-e14f-4dee-9255-faf52c86848d" class="bulleted-list"><li style="list-style-type:disc"><strong>port</strong> — указывает на каком порту или портах запущен целевой сервис</li></ul><ul id="db832aeb-b963-4a64-9dd3-a2a8524951d4" class="bulleted-list"><li style="list-style-type:disc"><strong>filter</strong> — имя фильтра с регулярными выражениями, по которым идёт поиск «подозрительных совпадений» в журналах сервиса</li></ul><ul id="d4c621d2-68e4-4722-a89d-2e1d1715d448" class="bulleted-list"><li style="list-style-type:disc"><strong>logpath</strong> — путь к файлу журнала, который программа Fail2ban будет обрабатывать с помощью заданного ранее фильтра. Вся история удачных и неудачных входов в систему, в том числе и по SSH, по умолчанию записывается в log–файл<br/><br/></li></ul><h2 id="6a372991-3728-488c-9cd9-998903a1f2ba" class="">Пример настройки fail2ban</h2><p id="122ab83d-4adb-47ec-9b97-723358945754" class="">Прежде чем вносить изменения следуя рекомендациям, отметим, что не стоит редактировать основной файл настроек <code>jail.conf</code>, для этого предусмотрены файлы с расширением <code>*.local</code>, которые автоматически подключаются и имеют высший приоритет.</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ffe2535d-efab-481c-bc33-89ef5145ff24" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">$ nano /etc/fail2ban/jail.local</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="45bea651-6425-4e0d-aa19-5b18d6166da3" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">[DEFAULT]
## Постоянный IP-адрес.
## Если не переопределить ignoreip здесь,
## то стоит закомментировать этот параметр в jail.conf.
ignoreip = 57.66.158.131

[ssh]
## если в течении 1 часа:
findtime    = 3600
## произведено 6 неудачных попыток логина:
maxretry    = 6
## то банить IP на 24 часа:
bantime     = 86400</code></pre><p id="76551ade-e2b8-4a0d-b33e-ee44e4f043f6" class="">Осталось перезапустить Fail2ban:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0b51f59c-b4d9-4d51-b81d-56fea0b79363" class="code"><code class="language-Plain Text" style="white-space:pre-wrap;word-break:break-all">$ service fail2ban restart</code></pre><p id="a3256ad9-aaae-4f01-80c5-de0558af5c17" class="">
</p><p id="67d87294-a8b5-4069-b671-178474e80a7a" class="">
</p><h1 id="540fd4ce-1168-4500-a299-144b84e231a7" class="">Практика Iptables</h1><p id="d2bc42d3-8ba8-4ca5-897a-d761f0fa7d5d" class="">
</p><p id="2d5713c9-3a9c-4bfb-b74e-5b8d67c3b680" class="">
</p><h3 id="67cd5dab-ad8c-4fc0-bc56-2cbd58630bc1" class=""><strong>Отклонить все исходящие сетевые подключения</strong></h3><ol type="1" id="7d4c012e-1da7-4529-b60d-b0cafc484009" class="numbered-list" start="1"><li>Вторая строка правил разрешает только текущие исходящие и установленные соединения.</li></ol><ol type="1" id="c38eba04-ccee-4248-8882-cbd057a3ea43" class="numbered-list" start="2"><li>Это очень полезно, когда вы вошли на сервер через ssh или telnet.</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2c5a9ee1-52e8-4344-802b-e9e7f93d7bf5" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ iptables -F OUTPUT
$ iptables -A OUTPUT -m state --state ESTABLISHED -j ACCEPT
$ iptables -A OUTPUT -j REJECT
</code></pre><h3 id="84d4226d-4f78-4548-a90d-240b65134b7e" class=""><strong>Правило iptables: Отклонение всех входящих сетевых подключений</strong></h3><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c53dc52a-b484-4a86-8132-ce14525f501c" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ iptables -F INPUT
$ iptables -A INPUT -m state --state ESTABLISHED -j ACCEPT
$ iptables -A INPUT -j REJECT
</code></pre><h3 id="0f5a5390-d3bc-453c-813b-2bb087965675" class=""><strong>Правило iptables: Отклонение всех сетевых подключений</strong></h3><ol type="1" id="1f10a31a-81b1-49cc-b9b7-8c102b6147f7" class="numbered-list" start="1"><li>Это правило отключит и заблокирует все сетевые соединения, входящие или исходящие.</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f6188857-3f2a-4d1d-bdec-24b826ba912e" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ iptables -F
$ iptables -A INPUT -j REJECT
$ iptables -A OUTPUT -j REJECT
$ iptables -A FORWARD -j REJECT
</code></pre><h3 id="f45e8ae3-2cd0-4aad-9f68-2b206a2520c3" class=""><strong>Правило iptables: Отклонение входящих запросов ping</strong></h3><p id="0f61b7e4-628b-4d22-8199-78c2e0891498" class=""><strong>Это правило iptables сбрасывает все входящие запросы ping.</strong></p><ol type="1" id="48948e1d-ed5c-4305-9703-44c9fe1ff737" class="numbered-list" start="1"><li>Разница между DROP и REJECT заключается в том, что DROP автоматически отбрасывает входящий пакет, тогда как REJECT приведет к возврату ошибки ICMP.</li></ol><p id="03e7bfc1-5743-462a-b62a-173a457f6eab" class=""><code># iptables -A INPUT -p icmp --icmp-type echo-request -j DROP</code></p><h3 id="7fa0468d-22ce-4ea2-ab49-dff56bab4ed4" class=""><strong>Правило iptables: Разрыв исходящих telnet-соединений</strong></h3><ol type="1" id="3dbe523c-8f9c-4ad5-8292-8d9c62f8c8c3" class="numbered-list" start="1"><li>Это правило iptables блокирует любой исходящий трафик на любой хост, порт назначения которого равен 23 (telnet)</li></ol><p id="478cf589-e879-4f29-a9b0-0698978e6ce8" class=""><code># iptables -A OUTPUT -p tcp --dport telnet -j REJECT# iptables -A INPUT -p tcp --dport telnet -j REJECT</code></p><p id="c7b1e335-ffe3-4dec-b138-5597c6eafdfd" class=""><code># iptables -A OUTPUT -p tcp --dport telnet -j DROP# iptables -A INPUT -p tcp --dport telnet -j DROP</code></p><p id="d28fade9-1a85-4212-a2bd-8c2d7f4e356a" class="">Для организации сеанса Telnet-связи с другим компьютером используется следующая команда:</p><p id="a2c763fa-75e4-4a38-97e3-81e58313a152" class=""><code>telnet &lt;ip address&gt;</code></p><h3 id="ee6c0594-35c0-417e-913a-87fec184e447" class=""><strong>Правило iptables: Отклонение исходящих ssh-соединений</strong></h3><ol type="1" id="3a916727-47c4-49b7-951b-3f3b80a67532" class="numbered-list" start="1"><li>Это правило iptables будет отклонять все исходящие соединения, поступающие с локального порта 22 (ssh).</li></ol><p id="ef5cf510-04eb-4f82-843e-1473c7c4c075" class=""><code># iptables -A OUTPUT -p tcp --dport ssh -j REJECT</code></p><h3 id="280ccccd-291f-4c7c-8723-7d539422fb8d" class=""><strong>Правило iptables: Отклонение входящих ssh-соединений</strong></h3><ol type="1" id="e0f1f5a6-407b-43d4-990f-356e75dc92d7" class="numbered-list" start="1"><li>Сброс всех входящих подключений к локальному порту 22 (ssh).</li></ol><p id="f0dfd0af-0288-4da0-ace1-9551879d462c" class=""><code># iptables -A INPUT -p tcp --dport ssh -j REJECT</code></p><h3 id="73cdc8d6-cfa3-42b1-bcef-f10c28566d7f" class=""><strong>Правило iptables: Отклонение всего входящего трафика, кроме ssh и локальных подключений.</strong></h3><ol type="1" id="5760493a-c4fa-4b78-98be-d409219e0dc6" class="numbered-list" start="1"><li>Эти правила будут отклонять все входящие подключения к серверу, кроме подключений к порту 22 (SSH).</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1042177d-58c6-43a7-9104-8d2cff47945a" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ iptables -A INPUT -i lo -j ACCEPT
$ iptables -A INPUT -p tcp --dport ssh -j ACCEPT
$ iptables -A INPUT -j REJECT
</code></pre><h3 id="b1b7647d-c1f3-4d39-abab-cd2e1b9fc9f3" class=""><strong>Правило iptables: Прием входящих ssh-соединений с определенного IP-адреса.</strong></h3><ol type="1" id="adf9b840-75c3-472c-a2d5-24cd774cf693" class="numbered-list" start="1"><li>Используя это правило iptables, мы заблокируем все входящие подключения к порту 22 (ssh), кроме хоста с IP-адресом 77.66.55.44.</li></ol><ol type="1" id="31b2a57f-92cc-498d-82eb-5b99afba7044" class="numbered-list" start="2"><li>Это означает, что только хост с IP 77.66.55.44 сможет использовать ssh.</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6e6caaae-0a10-4f9e-8588-0898e3db5d03" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ iptables -A INPUT -p tcp -s 77.66.55.44 --dport ssh -j ACCEPT
$ iptables -A INPUT -p tcp --dport ssh -j REJECT
</code></pre><h3 id="7ac17283-47b4-4821-9130-c1c395b7777c" class=""><strong>Правило iptables: Прием входящих ssh-соединений с определенного MAC-адреса.</strong></h3><ol type="1" id="830bc945-0048-4199-9d75-c7bba487bbbc" class="numbered-list" start="1"><li>Используя это правило iptables, мы заблокируем все входящие подключения к порту 22 (ssh), кроме хоста с MAC-адресом 00:e0:4c:f1:41:6b.</li></ol><ol type="1" id="4feb9b48-cc13-4136-8639-624f9c7ddb80" class="numbered-list" start="2"><li>Другими словами, все ssh-соединения будут ограничены одним хостом с MAC-адресом 00:e0:4c:f1:41:6b.</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4d92780d-cc46-495b-8305-829783aa23dd" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ iptables -A INPUT -m mac --mac-source 00:e0:4c:f1:41:6b -p tcp --dport ssh -j ACCEPT
$ iptables -A INPUT -p tcp --dport ssh -j REJECT
</code></pre><h3 id="daefc5fa-cd55-402d-aa6e-d2b881ef8ad0" class=""><strong>Правило iptables: Отклонение входящих подключений на определенном TCP-порту.</strong></h3><ol type="1" id="6dfc3de9-b917-4127-806c-148d8209a816" class="numbered-list" start="1"><li>Следующее правило iptables сбрасывает весь входящий трафик на TCP-порту 3333.</li></ol><p id="7dcfd562-9bfb-43a4-9046-92c0feaab47b" class=""><code># iptables -A INPUT -p tcp --dport 3333 -j REJECT</code></p><h3 id="667e0cdb-a613-44e5-9194-e4ca1c4806bc" class=""><strong>Правило iptables: Отклонять весь входящий трафик Telnet, кроме указанного IP-адреса.</strong></h3><ol type="1" id="212b7d88-daa4-4294-abca-beed9a24dcf2" class="numbered-list" start="1"><li>Следующее правило iptables отклоняет весь входящий трафик Telnet, кроме запроса на соединение с IP-адреса 222.111.111.222.</li></ol><p id="2de5d586-07a2-4911-89be-3af181691d6d" class=""><code># iptables -A INPUT -t filter ! -s 222.111.111.222 -p tcp --dport 23 -j REJECT</code></p><ul id="fbc636bf-5e34-4c2a-8ebe-8c1bff4df230" class="bulleted-list"><li style="list-style-type:disc">Восклицательный знак, разделенный пробелом со значением параметра, означает, что правило распространяется на все пакеты</li></ul><ul id="b825fa7b-6835-4fa5-9aba-084b9fe6923e" class="bulleted-list"><li style="list-style-type:disc">Напоминаю, все правила в netfilter распределены по таблицам. Чтобы работать с конкретной таблицей, необходимо использовать ключ -t.</li></ul><ul id="99ae852a-b15f-483f-bdcc-195af9f3e0d6" class="bulleted-list"><li style="list-style-type:disc">t filter. Таблица по умолчанию. С ней работаем, если упускаем ключ -t. Встроены три цепочки — INPUT (входящие), OUTPUT (исходящие) и FORWARD (проходящие пакеты)</li></ul><h3 id="95ab81ac-33c2-468f-9d31-3a7b3aed414c" class=""><strong>Восклицатеьный знак ! инвертирует условие.</strong></h3><p id="65816ae6-1d83-4965-9dcf-da7c0d7ae790" class=""><strong>например:</strong></p><p id="f18df3e0-f780-4eb7-b74d-b5c1c33fe7a1" class=""><code>iptables -A INPUT -s ! 192.168.0.50 -j DROP</code></p><ul id="15b8ed1c-554c-407d-94d3-4d769b223b35" class="bulleted-list"><li style="list-style-type:disc">запретит соединение всем хостам, кроме 192.168.0.50.</li></ul><h3 id="f11a3ede-6e50-4eda-9750-5ad5fe804a76" class=""><strong>Правило iptables: Отклонять весь входящий трафик ssh, кроме указанного диапазона IP-адресов.</strong></h3><ol type="1" id="e9cb5d1e-e62f-4ebd-ba56-7b75b3cadf70" class="numbered-list" start="1"><li>Следующее правило iptables отклоняет весь входящий трафик ssh, кроме запроса на соединение из диапазона IP-адресов 10.1.1.90 – 10.1.1.1.100.</li></ol><ol type="1" id="69f82391-758e-4c81-b051-02e7d0af4c3e" class="numbered-list" start="2"><li>Удаление “!” из приведенного ниже правила отклонить весь трафик ssh, исходящий из диапазона IP-адресов 10.1.1.90 – 10.1.1.100.</li></ol><p id="20ecca12-620a-42d2-b0ea-0f55910d8f28" class=""><code># iptables -A INPUT -t filter -m iprange ! --src-range 10.1.1.90-10.1.1.100 -p tcp --dport 22 -j REJECT</code></p><ul id="f8594ba6-0132-4abf-b230-dcf6c0bcdd16" class="bulleted-list"><li style="list-style-type:disc">–src-range – диапазон IP источников; в отличии от --source и --destination позволяет указать диапазон между двумя конкретными адресами, а не подсетью; допустимо инвертирование (!)</li></ul><h3 id="049d052e-aa32-4cbc-8001-93b3ac674dbe" class=""><strong>Правило iptables: Отклонять весь весь исходящий трафик на конкретный удаленный хост.</strong></h3><ol type="1" id="b6a4987c-4fe9-498a-941b-66c17adac609" class="numbered-list" start="1"><li>Следующее правило iptables отклоняет весь исходящий трафик на удаленный хост с IP-адресом 222.111.111.222.</li></ol><p id="ab03cce8-5e51-453d-a1ce-ad0f17115939" class=""><code># iptables -A OUTPUT -d 222.111.111.222 -j REJECT</code></p><h3 id="cf4b72fd-b4b1-404f-91ae-6ae79a840396" class=""><strong>Записать событие и сбросить.</strong></h3><ol type="1" id="cfa3240d-6185-4f77-9741-995d1eb22eb6" class="numbered-list" start="1"><li>Чтобы записать в журнал движение пакетов перед сбросом, добавим правило:</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="023e12b3-0bb0-422f-b692-40e1eb489a4f" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j LOG --log-prefix &quot;IP_SPOOF A: &quot;
$ iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j DROP
</code></pre><ol type="1" id="71e43a5f-92e1-4a67-9f36-41dd25719b4c" class="numbered-list" start="1"><li>Проверим журнал (по умолчанию /var/log/messages):</li></ol><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="edcadfff-19e9-477a-be62-5d51ab17c970" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">$ tail -f /var/log/messages
$ grep -i --color &#x27;IP SPOOF&#x27; /var/log/messages</code></pre><p id="a2c817a7-0bd5-47d4-9acd-87fe1c0394e2" class="">
</p><h1 id="8f33f72e-fbfa-455b-8d16-a80678a566e7" class="">Практика Fail2ban</h1><p id="4dca7543-9e6e-41a4-b7d9-8b21dc95eaa8" class="">
</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="383b1ebc-83e0-477d-8818-610cc53fccef" class="code"><code class="language-Shell">apt install fail2banapt install ipset</code></pre><p id="e6f67ad3-fb01-4eab-88a8-32c7c35bd73f" class=""><strong>Давайте найдём параметр бан в jail.conf или во вновь созданном файле jail.local внесём следующие параметры:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="09291b2d-4e3c-44f1-add9-34a022a1dc37" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">[sshd]
enable = true #модуль shhd включен
port = ssh #ваш номер порта ssh
filter = sshd #применяемый фильтр
logpath = /var/log/auth.log #log-файл
maxretry = 3 #максимальное количество попыток входа
bantime = 3600 #после максимального количества попыток забанить на 3600 сек
ignoreip = 127.0.0.1 #
</code></pre><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b14017e5-d05c-4789-86b9-6b9f6edde3a7" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">[nginx-limit-req]
port = http, https
enabled = true
filter = nginx-limit-req
action = iptables-multiport[name=ReqLimit, port=&quot;http,https&quot;, protocol=tcp]
logpath = /var/log/nginx/*error.log
findtime = 600
bantime = 3600
maxretry = 4
</code></pre><p id="62ccc510-f499-42f2-bdd7-2a56e9281620" class="">Но как мы уже знаем, настройки конфигурационных файлов поумолчанию могут быть перезаписаны при обновлении, поэтому создаём новый файл:</p><p id="179b9a3e-5ddc-4e3c-beca-76a7790a9633" class=""><code>touch iptables-blocktype.local</code></p><p id="119d13c1-6653-487e-a92e-d425dd732c28" class="">где нам нужно внести следующую настройку:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="527f5f8c-c14e-4bfe-9b86-468684e9f7e2" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">[Init]
blocktype = DROP</code></pre><p id="158b7640-42b4-45a4-9f29-f3e7d526d906" class=""><code>service fail2ban restart</code></p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>